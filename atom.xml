<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Nan&#39;s Blog</title>
  
  <subtitle>弱者才言命，强者只言运！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="/"/>
  <updated>2020-07-23T01:33:16.557Z</updated>
  <id>/</id>
  
  <author>
    <name>马亮南生</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CentOS7升级内核</title>
    <link href="/2020/07/22/CentOS7%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/"/>
    <id>/2020/07/22/CentOS7升级内核/</id>
    <published>2020-07-22T11:04:47.000Z</published>
    <updated>2020-07-23T01:33:16.557Z</updated>
    
    <content type="html"><![CDATA[<p>引用：<a href="https://www.cnblogs.com/ding2016/p/10429640.html" target="_blank" rel="noopener">centos7升级内核至最新</a></p><h2 id="应用背景"><a href="#应用背景" class="headerlink" title="应用背景"></a>应用背景</h2><p>最近在接触docker，其对内核版本要求较高，就连目前使用的centos7.x默认内核版本为3.10.0-xxx，也是刚好满足其最低要求，故借此机会记录一下升级内核的操作步骤。</p><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>系统</th><th>当前内核版本</th><th><strong>小版本升级</strong></th></tr></thead><tbody><tr><td>CentOS 7.6</td><td>3.10.0-957</td><td>3.10.0-957.5.1</td></tr></tbody></table><table><thead><tr><th>系统</th><th>当前内核版本</th><th><strong>大版本升级</strong></th></tr></thead><tbody><tr><td>CentOS 7.6</td><td>3.10.0-957</td><td>4.20.12-1(目前最新)</td></tr></tbody></table><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="小版本升级"><a href="#小版本升级" class="headerlink" title="小版本升级"></a>小版本升级</h3><ol><li><p>查看当前和可升级版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum list kernel</span><br><span class="line"><span class="comment"># 以下是输出</span></span><br><span class="line">Installed Packages</span><br><span class="line">kernel.x86_64            3.10.0-957.el7                @anaconda</span><br><span class="line">Available Packages</span><br><span class="line">kernel.x86_64            3.10.0-957.5.1.el7            updates</span><br></pre></td></tr></table></figure></li><li><p>升级</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update kernel -y</span><br></pre></td></tr></table></figure></li><li><p>重启并检查</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot 　</span><br><span class="line">uname -r</span><br></pre></td></tr></table></figure></li></ol><h3 id="大版本升级"><a href="#大版本升级" class="headerlink" title="大版本升级"></a>大版本升级</h3><ol><li><p>载入公钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure></li><li><p>升级安装ELRepo</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh \</span><br><span class="line">http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>载入elrepo-kernel元数据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=\* --enablerepo=elrepo-kernel repolist</span><br></pre></td></tr></table></figure></li><li><p>查看可用的rpm包</p><p><strong>说明：</strong></p><ul><li><code>lt ：</code>long term support，长期支持版本</li><li><code>ml：</code>mainline，主线版本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=\* --enablerepo=elrepo-kernel list kernel*</span><br><span class="line"><span class="comment"># 以下是输出</span></span><br><span class="line">Installed Packages</span><br><span class="line">kernel.x86_64                      3.10.0-957.el7         @anaconda    </span><br><span class="line">kernel.x86_64                      3.10.0-957.5.1.el7     @updates     </span><br><span class="line"><span class="comment"># 当前版本（有下划线标识）</span></span><br><span class="line">kernel-tools.x86_64                3.10.0-957.el7         @anaconda    </span><br><span class="line">kernel-tools-libs.x86_64           3.10.0-957.el7         @anaconda    </span><br><span class="line"></span><br><span class="line">Available Packages</span><br><span class="line">kernel-lt.x86_64                   4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-devel.x86_64             4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-doc.noarch               4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-headers.x86_64           4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-tools.x86_64             4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-tools-libs.x86_64        4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel<span class="_">-lt</span>-tools-libs-devel.x86_64  4.4.176-1.el7.elrepo   elrepo-kernel</span><br><span class="line"><span class="comment"># 安装目标版本</span></span><br><span class="line">kernel-ml.x86_64                   4.20.12-1.el7.elrepo   elrepo-kernel　</span><br><span class="line">kernel-ml-devel.x86_64             4.20.12-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel-ml-doc.noarch               4.20.12-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel-ml-headers.x86_64           4.20.12-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel-ml-tools.x86_64             4.20.12-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs.x86_64        4.20.12-1.el7.elrepo   elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs-devel.x86_64  4.20.12-1.el7.elrepo   elrepo-kernel</span><br></pre></td></tr></table></figure></li><li><p>安装某一版本的kernel</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=\* --enablerepo=elrepo-kernel install kernel-ml.x86_64 -y</span><br></pre></td></tr></table></figure></li><li><p>删除旧版本工具包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove kernel-tools-libs.x86_64 kernel-tools.x86_64  -y</span><br></pre></td></tr></table></figure></li><li><p>安装新版本工具包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=\* --enablerepo=elrepo-kernel install kernel-ml-tools.x86_64 -y</span><br></pre></td></tr></table></figure></li><li><p>查看内核插入顺</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk -F \<span class="string">' '</span><span class="variable">$1</span>==<span class="string">"menuentry "</span> &#123;<span class="built_in">print</span> i++ <span class="string">" : "</span> <span class="variable">$2</span>&#125;<span class="string">' /etc/grub2.cfg</span></span><br><span class="line"><span class="string"># 以下是输出</span></span><br><span class="line"><span class="string">0 : CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string">1 : CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string">2 : CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string">3 : CentOS Linux (0-rescue-ca0f6fb3c5f24478abc0a2e275281d7a) 7 (Core)</span></span><br></pre></td></tr></table></figure><p><strong>说明：</strong>默认新内核是从头插入，默认启动顺序也是从0开始（当前顺序还未生效），或者使用：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">"^menuentry"</span> /boot/grub2/grub.cfg | cut -d <span class="string">"'"</span> -f2</span><br><span class="line"><span class="comment"># 以下是输出</span></span><br><span class="line">CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span><br><span class="line">CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span><br><span class="line">CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span><br><span class="line">CentOS Linux (0-rescue-ca0f6fb3c5f24478abc0a2e275281d7a) 7 (Core)</span><br></pre></td></tr></table></figure><p>其中文件<code>/etc/grub2.cfg</code>和<code>/boot/grub2/grub.cfg</code>内容一致</p></li><li><p>查看当前实际启动顺序</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grub2-editenv list</span><br><span class="line"><span class="comment"># 以下是输出</span></span><br><span class="line">saved_entry=CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span><br></pre></td></tr></table></figure></li><li><p>设置默认启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># “4.20.12-1.el7.elrepo.x86_64”选你自己需要升级的版本号</span></span><br><span class="line">grub2-set-default <span class="string">'CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)'</span></span><br><span class="line"><span class="comment"># 查看当前实际启动顺序</span></span><br><span class="line">grub2-editenv list</span><br><span class="line">saved_entry=CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span><br></pre></td></tr></table></figure><p><code>或者直接设置数值</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0代表当前第一行，也就是上面的4.20.12版本那一行内容</span></span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-editenv list</span><br><span class="line">saved_entry=0</span><br></pre></td></tr></table></figure></li><li><p>重启并检查</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line">uname -r</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;引用：&lt;a href=&quot;https://www.cnblogs.com/ding2016/p/10429640.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;centos7升级内核至最新&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;应用背景&quot;&gt;&lt;a href
      
    
    </summary>
    
      <category term="CentOS" scheme="/categories/CentOS/"/>
    
    
      <category term="Linux" scheme="/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>数据迁移</title>
    <link href="/2020/07/17/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/"/>
    <id>/2020/07/17/数据迁移/</id>
    <published>2020-07-17T06:11:46.000Z</published>
    <updated>2020-07-17T08:42:44.925Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>cp</strong> 是在本机进行拷贝不能跨服务器</p></blockquote><blockquote><p><strong>scp</strong> 是secure copy的简写，用于在Linux下进行远程拷贝文件的命令， scp传输是加密的，可能会稍微影响一下速度，当你服务器硬盘变为只读 read only system时，用scp可以帮你把文件移出来，另 外，scp还非常不占资源，不会提高多少系统负荷，在这一点上，rsync就远远不及它了，虽然 rsync比scp会快一点，但当小文件众多的情况 下，rsync会导致硬盘I/O非常高，而scp基本不影响系统正常使用</p></blockquote><blockquote><p><strong>rsync</strong> 迁移单个没有太多小文件的数时比scp优秀，速度快</p></blockquote><h2 id="scp命令"><a href="#scp命令" class="headerlink" title="scp命令"></a>scp命令</h2><h2 id="rsync命令"><a href="#rsync命令" class="headerlink" title="rsync命令"></a>rsync命令</h2><h3 id="rsync的参数说明"><a href="#rsync的参数说明" class="headerlink" title="rsync的参数说明"></a>rsync的参数说明</h3><blockquote><p><strong>-v</strong> 详细输出</p><p><strong>-z</strong>  传输时进行压缩以提高传输效率。</p><p><strong>-a</strong> 归档模式，表示以递归的方式传输文件，并保持文件的属性</p><p><strong>–exclude</strong> 排除不需要同步传输的文件或者目录</p><p><strong>–delete</strong>  让目标目录和源目录的数据一致</p><p><strong>–bwlimit</strong> 限制带宽，默认单位是：kb（案例：某DBA做数据同步，导致用户无法访问网站）</p><p><strong>–info=progress2</strong> 给出了一个很好的整体进度百分比（局部值）</p></blockquote><h3 id="无密码通过ssh执行rsync"><a href="#无密码通过ssh执行rsync" class="headerlink" title="无密码通过ssh执行rsync"></a>无密码通过ssh执行rsync</h3><p>默认情况下，在执行rsync命令时通常需要我们<code>输入密码</code>。但有时我们并不希望如此，那么如何实现无密码执行rsync呢？</p><h4 id="需要密码"><a href="#需要密码" class="headerlink" title="需要密码"></a>需要密码</h4><ol><li><p>测试通过ssh可以执行rsync（需要密码）</p><p>执行rsync，确保你帐户的密码在远程服务器上可以使用，并能够将文件复制到远程服务器。<br>例：将原服务器<code>文件/root/mm.sh</code>同步到远程目录<code>/usr/share/nginx/html</code>(服务器地址：<code>172.18.195.253</code>) ，执行此操作时，服务器会要求你输入密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz --info=progress2 /root/mm.sh 172.18.195.253:/usr/share/nginx/html</span><br></pre></td></tr></table></figure></li></ol><h4 id="免密"><a href="#免密" class="headerlink" title="免密"></a>免密</h4><ol><li><p>使用<code>ssh-keygen</code>生成密匙</p><p>现在我们来配置ssh使得通过ssh执行rsync时不再索要密码。在原服务器上使用ssh-keygen生成公钥和秘钥。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line"><span class="comment"># 直接回车</span></span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</span><br><span class="line"><span class="comment"># 直接回车</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line"><span class="comment"># 直接回车</span></span><br><span class="line">Enter same passphrase again:</span><br></pre></td></tr></table></figure><p>注意：当它要求您输入passphrase<code>按下enter键，不需要给任何密码</code></p></li><li><p>使用<code>ssh-copy-id</code>将公匙拷贝至远程主机</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip 就是目标服务器地址</span></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub 172.18.195.253</span><br></pre></td></tr></table></figure><p>注：执行以上操作时会要求你输入远程主机帐户和密码，然后就会自动将公钥拷贝至远程目录。</p></li><li><p>无需密码通过ssh来执行rsync</p><p>现在，你可以不需要密码通过ssh连接到远程主机</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 172.18.195.253</span><br></pre></td></tr></table></figure><p><img src="/img/rsync001.png" alt=""></p><p>再次执行rsync，它将不再要求你输入密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz --info=progress2 /root/mm.sh 172.18.195.253:/usr/share/nginx/html</span><br></pre></td></tr></table></figure><p><img src="/img/rsync002.png" alt=""></p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;cp&lt;/strong&gt; 是在本机进行拷贝不能跨服务器&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;scp&lt;/strong&gt; 是secure copy的简写，用于在Linux下进行远程拷贝文件的
      
    
    </summary>
    
      <category term="远程拷贝" scheme="/categories/%E8%BF%9C%E7%A8%8B%E6%8B%B7%E8%B4%9D/"/>
    
    
      <category term="rsync" scheme="/tags/rsync/"/>
    
  </entry>
  
  <entry>
    <title>值得推荐的idea优秀插件</title>
    <link href="/2020/07/13/%E5%80%BC%E5%BE%97%E6%8E%A8%E8%8D%90%E7%9A%84idea%E4%BC%98%E7%A7%80%E6%8F%92%E4%BB%B6/"/>
    <id>/2020/07/13/值得推荐的idea优秀插件/</id>
    <published>2020-07-13T07:52:13.000Z</published>
    <updated>2020-07-13T10:03:33.471Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h2><p>Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率。例如开发中经常需要写的javabean，都需要花时间去添加相应的getter/setter，也许还要去写构造器、equals等方法，而且需要维护，当属性多时会出现大量的getter/setter方法，这些显得很冗长也没有太多技术含量，一旦修改属性，就容易出现忘记修改对应方法的失误。Lombok能通过注解的方式，在编译时自动为属性生成构造器、getter/setter、equals、hashcode、toString方法。</p><ol><li><p>idea下载安装插件</p></li><li><p>在使用之前需要添加一下依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="POJO类常用注解"><a href="#POJO类常用注解" class="headerlink" title="POJO类常用注解"></a>POJO类常用注解</h3><ul><li><strong>@Getter/@Setter</strong>： 作用类上，生成所有成员变量的getter/setter方法；作用于成员变量上，生成该成员变量的getter/setter方法。可以设定访问权限及是否懒加载等</li><li><strong>@ToString：</strong>作用于类，覆盖默认的toString()方法，可以通过of属性限定显示某些字段，通过exclude属性排除某些字段</li><li><strong>@EqualsAndHashCode：</strong>作用于类，覆盖默认的equals和hashCode</li><li><strong>@NonNull：</strong>主要作用于成员变量和参数中，标识不能为空，否则抛出空指针异常</li><li><strong>@NoArgsConstructor, @RequiredArgsConstructor, @AllArgsConstructor：</strong>作用于类上，用于生成构造函数。有staticName、access等属性 - <code>(staticName属性一旦设定，将采用静态方法的方式生成实例，access属性可以限定访问权限)</code><ul><li><strong>@NoArgsConstructor：</strong>生成无参构造器</li><li><strong>@RequiredArgsConstructor：</strong>生成包含final和@NonNull注解的成员变量的构造器</li><li><strong>@AllArgsConstructor：</strong>生成全参构造器</li></ul></li><li><strong>@Data：</strong>作用于类上，是以下注解的集合：<code>@ToString @EqualsAndHashCode @Getter @Setter @RequiredArgsConstructor</code></li><li><strong>@Builder：</strong>作用于类上，将类转变为建造者模式</li><li><strong>@Log：</strong>作用于类上，生成日志变量。针对不同的日志实现产品，有不同的注解</li></ul><h3 id="其他重要注解"><a href="#其他重要注解" class="headerlink" title="其他重要注解"></a>其他重要注解</h3><ul><li><p><strong>@Cleanup：</strong>自动关闭资源，针对实现了java.io.Closeable接口的对象有效，如：典型的IO流对象</p></li><li><p><strong>@SneakyThrows：</strong>可以对受检异常进行捕捉并抛出</p></li><li><p><strong>@Synchronized：</strong>作用于方法级别，可以替换synchronize关键字或lock锁，用处不大</p></li></ul><h2 id="MybatisX"><a href="#MybatisX" class="headerlink" title="MybatisX"></a>MybatisX</h2><p>MybatisX 是一款基于 IDEA 的快速开发插件，为效率而生</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul><li>Java 与 XML 调回跳转</li><li>Mapper 方法自动生成 XML</li></ul><h3 id="计划支持"><a href="#计划支持" class="headerlink" title="计划支持"></a>计划支持</h3><ul><li>连接数据源之后 xml 里自动提示字段</li><li>sql 增删改查</li><li>集成 MP 代码生成</li><li>其他</li></ul><h2 id="Alibaba-Java-Coding-Guidelines"><a href="#Alibaba-Java-Coding-Guidelines" class="headerlink" title="Alibaba Java Coding Guidelines"></a>Alibaba Java Coding Guidelines</h2><p>一款阿里巴巴公司试行的开发设计规范~ </p><h3 id="Bug的严重程度、优先级如何定义"><a href="#Bug的严重程度、优先级如何定义" class="headerlink" title="Bug的严重程度、优先级如何定义"></a>Bug的严重程度、优先级如何定义</h3><ul><li><strong>Blocker：</strong> 即系统无法执行、崩溃或严重资源不足、应用模块无法启动或异常退出、无法测试、造成系统不稳定。<br>严重花屏、内存泄漏、用户数据丢失或破坏、系统崩溃/死机/冻结、模块无法启动或异常退出、严重的数值计算错误、功能设计与需求严重不符、其它导致无法测试的错误, 如服务器500错误</li><li><strong>Critical：</strong>即影响系统功能或操作，主要功能存在严重缺陷，但不会影响到系统稳定性。<br>功能未实现、功能错误、系统刷新错误、数据通讯错误、轻微的数值计算错误、影响功能及界面的错误字或拼写错误、安全性问题</li><li><strong>Major：</strong>即界面、性能缺陷、兼容性。<br>操作界面错误（包括数据窗口内列名定义、含义是否一致）、边界条件下错误、提示信息错误（包括未给出信息、信息提示错误等）、长时间操作无进度提示、系统未优化（性能问题）、光标跳转设置不好，鼠标（光标）定位错误、兼容性问题</li><li><strong>Minor/Trivial：</strong>即易用性及建议性问题。<br>界面格式等不规范、辅助说明描述不清楚、操作时未给用户提示、可输入区域和只读区域没有明显的区分标志、个别不影响产品理解的错别字、文字排列不整齐等一些小问题</li></ul><h3 id="犹如神助的功能"><a href="#犹如神助的功能" class="headerlink" title="犹如神助的功能"></a>犹如神助的功能</h3><p>阿里规范插件实时检查你书写的代码，并在右侧实时给出警告，警告也是汉字的！！</p><h4 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h4><p><strong>注：以下处理方式仅限Blocker，其他还需要自己手动修正</strong></p><ul><li><p>快捷键：Ait + Enter 自动补全（注：Windows 快捷键）</p></li><li><p>扫描结果面板，点击按钮自动补全</p></li></ul><h2 id="stackoverflow"><a href="#stackoverflow" class="headerlink" title="stackoverflow"></a>stackoverflow</h2><p>这个插件其实是最实用的插件，程序猿遇到的问题，基本都能找到回答，但是它使用的是google搜索引擎，对于，不购买vpn的同学来说，感觉好鸡肋呀~</p><p>选中需要搜索的问题，然后，右键点击查询 - <code>用StackoverFlow搜索的话个人觉得比用google 更精准</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Lombok&quot;&gt;&lt;a href=&quot;#Lombok&quot; class=&quot;headerlink&quot; title=&quot;Lombok&quot;&gt;&lt;/a&gt;Lombok&lt;/h2&gt;&lt;p&gt;Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率。例如开发中经常需要写的javabe
      
    
    </summary>
    
      <category term="IDEA" scheme="/categories/IDEA/"/>
    
    
      <category term="插件" scheme="/tags/%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>南生论坛页面静态展示v2.8.2</title>
    <link href="/2020/07/08/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%B1%95%E7%A4%BAv2-8-2/"/>
    <id>/2020/07/08/南生论坛页面静态展示v2-8-2/</id>
    <published>2020-07-08T13:34:33.000Z</published>
    <updated>2020-07-13T06:15:33.313Z</updated>
    
    <content type="html"><![CDATA[<p><strong>注：</strong><code>以下截图是v2.8.2的界面样子</code></p><h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><h4 id="南生论坛v2-8-2"><a href="#南生论坛v2-8-2" class="headerlink" title="南生论坛v2.8.2"></a>南生论坛v2.8.2</h4><p><code>在v2.6的基础上：</code> 对前后端代码和数据库表进行了全面重构，新增了闲聊，图片/视频文件压缩并上七牛云，优化系统，提升访问效率，新增轮播图管理、项目管理，运用了Redis缓存技术</p><h3 id="适用人员"><a href="#适用人员" class="headerlink" title="适用人员"></a>适用人员</h3><h4 id="南生论坛v2-8-2-1"><a href="#南生论坛v2-8-2-1" class="headerlink" title="南生论坛v2.8.2"></a>南生论坛v2.8.2</h4><p>该版本适用于对ssm框架<code>有一定熟悉度</code>、对代码规范度要求比较高、对<code>图片/视频文件上云</code>有兴趣的童鞋使用，主要可以通过该项目了解整个项目的设计思路（让<code>心怀大志</code>、<code>无从下手</code>的你找到突破口）</p><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><h4 id="南生论坛v2-8-2-2"><a href="#南生论坛v2-8-2-2" class="headerlink" title="南生论坛v2.8.2"></a>南生论坛v2.8.2</h4><p>注释十分详细、逻辑清晰、界面简洁美观、功能较完善、ECharts图表化展示、人机交互、异步加载、分页加载、统计记录、相册相片、支持Markdown、支持QQ分享文章、文章显示更加合理化（首页等展示文章的缩略信息-<code>可以提高文章的展示数量</code>；新增文章详情页面-<code>有利于读者专心于该文章而不被其它信息干扰</code>）、新增闲聊、图片/视频文件上云、新增轮播图管理、新增项目管理、Redis缓存技术、代码冗余度较低、命名规范</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>前后端未分离</p><h3 id="用户系统-展示"><a href="#用户系统-展示" class="headerlink" title="用户系统-展示"></a>用户系统-展示</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-登录v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-注册v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-首页v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-写文章v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="修改文章"><a href="#修改文章" class="headerlink" title="修改文章"></a>修改文章</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-修改文章v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="文章详情"><a href="#文章详情" class="headerlink" title="文章详情"></a>文章详情</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-文章详情v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="闲聊"><a href="#闲聊" class="headerlink" title="闲聊"></a>闲聊</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-闲聊v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="毒鸡汤"><a href="#毒鸡汤" class="headerlink" title="毒鸡汤"></a>毒鸡汤</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-毒鸡汤v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="个人主页"><a href="#个人主页" class="headerlink" title="个人主页"></a>个人主页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-个人主页v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="他人主页"><a href="#他人主页" class="headerlink" title="他人主页"></a>他人主页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-他人主页v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="编辑个人资料"><a href="#编辑个人资料" class="headerlink" title="编辑个人资料"></a>编辑个人资料</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-编辑个人资料v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="基本信息设置"><a href="#基本信息设置" class="headerlink" title="基本信息设置"></a>基本信息设置</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-基本信息设置v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-上传头像v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-动态v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="回答"><a href="#回答" class="headerlink" title="回答"></a>回答</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-回答v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="关注"><a href="#关注" class="headerlink" title="关注"></a>关注</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-关注v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="收藏"><a href="#收藏" class="headerlink" title="收藏"></a>收藏</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-收藏v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-相册v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="有照片的相册"><a href="#有照片的相册" class="headerlink" title="有照片的相册"></a>有照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-有v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="无照片的相册"><a href="#无照片的相册" class="headerlink" title="无照片的相册"></a>无照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-无v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h3 id="管理系统-展示"><a href="#管理系统-展示" class="headerlink" title="管理系统-展示"></a>管理系统-展示</h3><h4 id="登录-1"><a href="#登录-1" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-登录v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="仪表盘"><a href="#仪表盘" class="headerlink" title="仪表盘"></a>仪表盘</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-仪表盘v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-用户管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="文章管理"><a href="#文章管理" class="headerlink" title="文章管理"></a>文章管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-文章管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="版块管理"><a href="#版块管理" class="headerlink" title="版块管理"></a>版块管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-版块管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-版本管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="轮播管理"><a href="#轮播管理" class="headerlink" title="轮播管理"></a>轮播管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-轮播管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-项目管理v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="访问记录"><a href="#访问记录" class="headerlink" title="访问记录"></a>访问记录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-访问记录v2.8.2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;注：&lt;/strong&gt;&lt;code&gt;以下截图是v2.8.2的界面样子&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;功能说明&quot;&gt;&lt;a href=&quot;#功能说明&quot; class=&quot;headerlink&quot; title=&quot;功能说明&quot;&gt;&lt;/a&gt;功能说明&lt;/h3&gt;&lt;h4 id=&quot;南
      
    
    </summary>
    
      <category term="南生论坛" scheme="/categories/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B/"/>
    
    
      <category term="展示" scheme="/tags/%E5%B1%95%E7%A4%BA/"/>
    
  </entry>
  
  <entry>
    <title>Java图片处理的几种方式</title>
    <link href="/2020/05/30/Java%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
    <id>/2020/05/30/Java图片处理的几种方式/</id>
    <published>2020-05-30T11:39:28.000Z</published>
    <updated>2020-06-01T07:56:05.817Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Maven依赖：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文件上传 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 时间操作组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="一、本地"><a href="#一、本地" class="headerlink" title="一、本地"></a>一、本地</h2><p><code>Java实现把图片上传到本地</code></p><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><code>path.properties配置如下：</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件保存公共路径</span></span><br><span class="line">data.store.local=/home/***/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文章图片（题图）</span></span><br><span class="line">articlePath=article</span><br><span class="line"><span class="comment"># 文章图片（配图）</span></span><br><span class="line">illustrationPath=illustration</span><br><span class="line"><span class="comment"># 用户头像</span></span><br><span class="line">userPath=user</span><br><span class="line"><span class="comment"># 用户相册</span></span><br><span class="line">photoPath=photo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许上传的文件后缀名，不包含"."</span></span><br><span class="line"><span class="comment">#data.store.local.suffix=png,jpg,jpeg</span></span><br><span class="line">data.store.local.suffix=*</span><br></pre></td></tr></table></figure><h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><p><code>ArticleController.java的内容：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/rest/nanshengbbs/v3.0/article"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">FileUploadUtil fileUploadUtil;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">PathUtil pathUtil;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/setArticle"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ReturnT&lt;?&gt; setArticle(<span class="meta">@RequestParam</span>(value = <span class="string">"picture"</span>, required = <span class="keyword">false</span>)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 保存文件</span></span><br><span class="line">String newFileName = fileUploadUtil.save(file, pathUtil.getArticlePath());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ReturnT.success(<span class="string">"发布文章成功"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">"发布文章失败"</span>);</span><br><span class="line"><span class="keyword">return</span> ReturnT.fail(<span class="string">"发布文章失败"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：文件保存到C:\home\nanshengbbs\data\article 或者 /home/nanshengbbs/data/article</span></span><br></pre></td></tr></table></figure><h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><h4 id="FileUploadUtil-java"><a href="#FileUploadUtil-java" class="headerlink" title="FileUploadUtil.java"></a>FileUploadUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FilenameUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PropertySource</span>(&#123;<span class="string">"classpath:path.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(FileUploadUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件存储根路径</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;data.store.local&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String rootPath;</span><br><span class="line">    <span class="comment">// 允许上传的文件后缀名</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;data.store.local.suffix&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; suffixList = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtil.isNotEmpty(suffix))&#123;</span><br><span class="line">            suffixList = Stream.of(suffix.split(<span class="string">"(, *)+"</span>))</span><br><span class="line">                .map(s -&gt; s.trim().toLowerCase()).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 源文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folder 文件夹名称（介于前者与后者之间）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(MultipartFile file, String folder)</span></span>&#123;</span><br><span class="line">        String orginalName = file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">if</span> (checkFile(orginalName))&#123; <span class="comment">// 检查文件后缀名</span></span><br><span class="line">            <span class="comment">// 构造存储文件名</span></span><br><span class="line">            String fileName = generateFileName(orginalName);</span><br><span class="line">            <span class="comment">// 构造目标文件路径</span></span><br><span class="line">            String targetPath = generateStorePath(folder, fileName);</span><br><span class="line">            <span class="comment">// 保存文件到指定目录</span></span><br><span class="line">            String path = storeData(targetPath, file);</span><br><span class="line">            logger.info(<span class="string">"已保存文件："</span> + path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">"不支持上传该类型的文件："</span> + orginalName);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fulPath 全路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String fulPath)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 封装上传文件位置的全路径</span></span><br><span class="line">        File targetFile = <span class="keyword">new</span> File(fulPath);</span><br><span class="line">        <span class="comment">// 删除文章对应的图片（实际删除）</span></span><br><span class="line">        targetFile.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造存储文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orginalName 原始文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回新的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateFileName</span><span class="params">(String orginalName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DateUtil.getNowDate() + <span class="string">"_"</span> + orginalName;<span class="comment">//“上传时间_文件名”</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造目标文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folder 文件夹名称（介于前者与后者之间）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateStorePath</span><span class="params">(String folder, String fileName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Paths.get(rootPath, folder, fileName).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存文件到指定目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 目标目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">storeData</span><span class="params">(String path, MultipartFile file)</span></span>&#123;</span><br><span class="line">        File stored = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">try</span> (InputStream in = file.getInputStream();)&#123;</span><br><span class="line">            FileUtils.copyInputStreamToFile(in, stored);</span><br><span class="line">            <span class="keyword">return</span> stored.getCanonicalPath();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查文件后缀名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 通过检查为true，不通过为false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkFile</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (suffixList.size() == <span class="number">1</span> &amp;&amp; suffixList.get(<span class="number">0</span>).equals(<span class="string">"*"</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String ext = FilenameUtils.getExtension(fileName);</span><br><span class="line">        <span class="keyword">return</span> suffixList.contains(ext.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="StringUtil-java"><a href="#StringUtil-java" class="headerlink" title="StringUtil.java"></a>StringUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data == <span class="keyword">null</span> || <span class="string">""</span>.equals(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串不为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !isEmpty(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PathUtil-java"><a href="#PathUtil-java" class="headerlink" title="PathUtil.java"></a>PathUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PropertySource</span>(&#123;<span class="string">"classpath:path.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathUtil</span> </span>&#123;</span><br><span class="line"><span class="comment">// 文章图片（题图）</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;articlePath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String articlePath;</span><br><span class="line"><span class="comment">// 文章图片（配图）</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;illustrationPath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String illustrationPath;</span><br><span class="line"><span class="comment">// 用户头像</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;userPath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String userPath;</span><br><span class="line"><span class="comment">// 用户相册</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;photoPath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String photoPath;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getArticlePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> articlePath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setArticlePath</span><span class="params">(String articlePath)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.articlePath = articlePath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getIllustrationPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> illustrationPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIllustrationPath</span><span class="params">(String illustrationPath)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.illustrationPath = illustrationPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUserPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserPath</span><span class="params">(String userPath)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userPath = userPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPhotoPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> photoPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhotoPath</span><span class="params">(String photoPath)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.photoPath = photoPath;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、图片服务器"><a href="#二、图片服务器" class="headerlink" title="二、图片服务器"></a>二、图片服务器</h2><p><code>Java实现把图片上传到图片服务器(nginx+vsftp)</code></p><p>nginx搭建参考：<a href="http://blog.nanshengbbs.top/2019/04/04/搭建http服务器-nginx/" target="_blank" rel="noopener">搭建http服务器-nginx</a></p><p>vsftp搭建参考：<a href="http://blog.nanshengbbs.top/2020/05/28/Vsftp安装与配置/" target="_blank" rel="noopener">Vsftp安装与配置</a></p><h3 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h3><p><code>path.properties配置如下：</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ftp相关配置</span></span><br><span class="line">ftp.address=*.*.*.*</span><br><span class="line">ftp.port=21</span><br><span class="line">ftp.username=ftpuser</span><br><span class="line">ftp.password=******</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件保存公共路径</span></span><br><span class="line">data.store.local=/home/ftpuser/***/data</span><br><span class="line"><span class="comment"># 图片服务器相关配置</span></span><br><span class="line">image.base.url=http://*.nanshengbbs.top/***/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文章图片（题图）</span></span><br><span class="line">articlePath=article</span><br><span class="line"><span class="comment"># 文章图片（配图）</span></span><br><span class="line">illustrationPath=illustration</span><br><span class="line"><span class="comment"># 用户头像</span></span><br><span class="line">userPath=user</span><br><span class="line"><span class="comment"># 用户相册</span></span><br><span class="line">photoPath=photo</span><br></pre></td></tr></table></figure><h3 id="调用-1"><a href="#调用-1" class="headerlink" title="调用"></a>调用</h3><p><code>ArticleController.java的内容：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/rest/nanshengbbs/v3.0/article"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">FtpUtil ftpUtil;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">PathUtil pathUtil;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/setArticle"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ReturnT&lt;?&gt; setArticle(<span class="meta">@RequestParam</span>(value = <span class="string">"picture"</span>, required = <span class="keyword">false</span>)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 构造文件名</span></span><br><span class="line">String fileName = UUIDUtil.getRandomUUID() + file.getOriginalFilename()</span><br><span class="line">                .substring(file.getOriginalFilename().lastIndexOf(<span class="string">"."</span>));</span><br><span class="line"><span class="comment">// 调用FtpUtil工具类进行上传</span></span><br><span class="line">String newFileName = ftpUtil.uploadFile(pathUtil.getArticlePath(), </span><br><span class="line">                                                    fileName, file.getInputStream());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ReturnT.success(<span class="string">"发布文章成功"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">"发布文章失败"</span>);</span><br><span class="line"><span class="keyword">return</span> ReturnT.fail(<span class="string">"发布文章失败"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：文件保存到（/home/ftpuser/nanshengbbs/data/article）</span></span><br></pre></td></tr></table></figure><h3 id="工具类-1"><a href="#工具类-1" class="headerlink" title="工具类"></a>工具类</h3><h4 id="FtpUtil-java"><a href="#FtpUtil-java" class="headerlink" title="FtpUtil.java"></a>FtpUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTP;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPReply;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PropertySource</span>(&#123;<span class="string">"classpath:path.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FtpUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">// FTP服务器ip</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ftp.address&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="comment">// FTP服务器端口</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ftp.port&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line">    <span class="comment">// FTP登录账号</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ftp.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">// FTP登录密码</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;ftp.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// FTP服务器基础目录（/home/ftpuser/nanshengbbs/data）</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;data.store.local&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String basePath;</span><br><span class="line">    <span class="comment">// 图片服务器相关配置</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;image.base.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String imageUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向FTP服务器上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath FTP服务器文件存放路径。例如文章配图：/article。</span></span><br><span class="line"><span class="comment">     * 文件的路径为basePath+filePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 上传到FTP服务器上的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input 输入流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功返回图片访问的全路径，否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadFile</span><span class="params">(String filePath, String fileName, InputStream input)</span> </span>&#123;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        FTPClient ftp = <span class="keyword">new</span> FTPClient();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 连接FTP服务器（如果采用默认端口，可以使用ftp.connect(host)的方式直接连接FTP服务器）</span></span><br><span class="line">            ftp.connect(host, port);</span><br><span class="line">            <span class="comment">// 登录</span></span><br><span class="line">            ftp.login(username, password);</span><br><span class="line">            <span class="comment">// 获取应答code</span></span><br><span class="line">            <span class="keyword">int</span> reply = ftp.getReplyCode();</span><br><span class="line">            <span class="comment">// 判断是否成功连接（成功：200 &lt;= n &lt;= 300）</span></span><br><span class="line">            <span class="keyword">if</span> (!FTPReply.isPositiveCompletion(reply)) &#123;</span><br><span class="line">                ftp.disconnect();</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 切换到上传目录</span></span><br><span class="line">            <span class="keyword">if</span> (!ftp.changeWorkingDirectory(Paths.get(basePath, filePath).toString())) &#123;</span><br><span class="line">                <span class="comment">// 如果目录不存在创建目录</span></span><br><span class="line">                String[] dirs = filePath.split(<span class="string">"/"</span>);</span><br><span class="line">                String tempPath = basePath;</span><br><span class="line">                <span class="keyword">for</span> (String dir : dirs) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> == dir || <span class="string">""</span>.equals(dir)) <span class="keyword">continue</span>;</span><br><span class="line">                    tempPath += <span class="string">"/"</span> + dir;</span><br><span class="line">                    <span class="keyword">if</span> (!ftp.changeWorkingDirectory(tempPath)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!ftp.makeDirectory(tempPath)) &#123;</span><br><span class="line">                            <span class="keyword">return</span> result;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            ftp.changeWorkingDirectory(tempPath);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 一定要加上ftp.enterLocalPassiveMode()设置被动模式，否则的话会出现图片传到服务器上去</span></span><br><span class="line"><span class="comment">             * 了，但是大小一直是0。这个方法的意思就是每次数据连接之前，ftp client告诉ftp server开通</span></span><br><span class="line"><span class="comment">             * 一个端口来传输数据。为什么要这样做呢，因为ftp server可能每次开启不同的端口来传输数据，但</span></span><br><span class="line"><span class="comment">             * 是在linux上或者其他服务器上面，由于安全限制，可能某些端口没有开启，所以就出现阻塞。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">// 设置为被动模式</span></span><br><span class="line">            ftp.enterLocalPassiveMode();</span><br><span class="line">            <span class="comment">// 设置上传文件的类型为二进制类型</span></span><br><span class="line">            ftp.setFileType(FTP.BINARY_FILE_TYPE);</span><br><span class="line">            <span class="comment">// 去中文</span></span><br><span class="line">            fileName = CommonUtil.getRemoveChinese(fileName);</span><br><span class="line">            <span class="comment">// 上传文件</span></span><br><span class="line">            <span class="keyword">if</span> (!ftp.storeFile(fileName, input)) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">            result = imageUrl + <span class="string">"/"</span> + filePath + <span class="string">"/"</span> + fileName;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                input.close();</span><br><span class="line">                ftp.logout();</span><br><span class="line">                <span class="keyword">if</span> (ftp.isConnected()) &#123;</span><br><span class="line">                    ftp.disconnect();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、第三方"><a href="#三、第三方" class="headerlink" title="三、第三方"></a>三、第三方</h2><p><code>Java实现把图片上传到七牛云对象存储</code></p><p>七牛官网：<a href="https://developer.qiniu.com/" target="_blank" rel="noopener">https://developer.qiniu.com/</a></p><p>对象存储Java SDK：<a href="https://developer.qiniu.com/kodo/sdk/1239/java" target="_blank" rel="noopener">https://developer.qiniu.com/kodo/sdk/1239/java</a></p><h3 id="配置文件-2"><a href="#配置文件-2" class="headerlink" title="配置文件"></a>配置文件</h3><p><code>76.properties配置如下：</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置你自己七牛云对应的AccessKey和SecretKey</span></span><br><span class="line">AccessKey=**************************************</span><br><span class="line">SecretKey==**************************************</span><br></pre></td></tr></table></figure><p><code>path.properties配置如下：</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 七牛对象存储对应的域名</span></span><br><span class="line">76.image.domain=http://*.nanshengbbs.top</span><br></pre></td></tr></table></figure><h3 id="调用-2"><a href="#调用-2" class="headerlink" title="调用"></a>调用</h3><p><code>ArticleController.java的内容：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/rest/nanshengbbs/v3.0/article"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">FtpUtil ftpUtil;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">PathUtil pathUtil;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/setArticle"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ReturnT&lt;?&gt; setArticle(<span class="meta">@RequestParam</span>(value = <span class="string">"picture"</span>, required = <span class="keyword">false</span>)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 构造文件名</span></span><br><span class="line">String fileName = UUIDUtil.getRandomUUID() + file.getOriginalFilename();</span><br><span class="line"><span class="comment">// 上传到七牛</span></span><br><span class="line">String newFileName = QiniuUtil.upload(file.getInputStream(), fileName);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ReturnT.success(<span class="string">"发布文章成功"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">"发布文章失败"</span>);</span><br><span class="line"><span class="keyword">return</span> ReturnT.fail(<span class="string">"发布文章失败"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：文件保存到（七牛云-&gt;对象存储-&gt;文件管理）</span></span><br></pre></td></tr></table></figure><h3 id="工具类-2"><a href="#工具类-2" class="headerlink" title="工具类"></a>工具类</h3><h4 id="QiniuUtil-java"><a href="#QiniuUtil-java" class="headerlink" title="QiniuUtil.java"></a>QiniuUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Region;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QiniuUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 需要操作的账号的AK和SK</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_KEY = </span><br><span class="line">        PropertyUtil.getProperties76().getProperty(<span class="string">"AccessKey"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET_KEY = </span><br><span class="line">        PropertyUtil.getProperties76().getProperty(<span class="string">"SecretKey"</span>);</span><br><span class="line">    <span class="comment">// 要上传的空间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String bucket = <span class="string">"nanshengbbs"</span>;</span><br><span class="line">    <span class="comment">// 密钥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String upToken = auth.uploadToken(bucket);</span><br><span class="line">    <span class="comment">// 构造一个带指定 Region 对象的配置类（华南）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Configuration cfg = <span class="keyword">new</span> Configuration(Region.huanan());</span><br><span class="line">    <span class="comment">// 创建上传对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UploadManager uploadManager = <span class="keyword">new</span> UploadManager(cfg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通上传（上传本地文件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> localFilePath 文件全路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 七牛保存的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload</span><span class="params">(String localFilePath, String fileName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 调用put方法上传</span></span><br><span class="line">        Response res = uploadManager.put(localFilePath, fileName, upToken);</span><br><span class="line">        <span class="comment">// 解析上传成功的结果</span></span><br><span class="line">        DefaultPutRet putRet = <span class="keyword">new</span> Gson()</span><br><span class="line">            .fromJson(res.bodyString(), DefaultPutRet.class);</span><br><span class="line">        <span class="keyword">return</span> putRet.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字节数组上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uploadBytes 文件字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 七牛保存的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload</span><span class="params">(<span class="keyword">byte</span>[] uploadBytes, String fileName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 调用put方法上传</span></span><br><span class="line">        Response res = uploadManager.put(uploadBytes, fileName, upToken);</span><br><span class="line">        <span class="comment">// 解析上传成功的结果</span></span><br><span class="line">        DefaultPutRet putRet = <span class="keyword">new</span> Gson()</span><br><span class="line">            .fromJson(res.bodyString(), DefaultPutRet.class);</span><br><span class="line">        <span class="keyword">return</span> putRet.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据流上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream 文件数据流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 七牛保存的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload</span><span class="params">(InputStream inputStream, String fileName)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 调用put方法上传</span></span><br><span class="line">        Response res = uploadManager.put(inputStream, fileName, upToken, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 解析上传成功的结果</span></span><br><span class="line">        DefaultPutRet putRet = <span class="keyword">new</span> Gson()</span><br><span class="line">            .fromJson(res.bodyString(), DefaultPutRet.class);</span><br><span class="line">        <span class="keyword">return</span> putRet.key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;Maven依赖：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="Java" scheme="/categories/Java/"/>
    
    
      <category term="Java图片处理" scheme="/tags/Java%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Vsftp安装与配置</title>
    <link href="/2020/05/28/Vsftp%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
    <id>/2020/05/28/Vsftp安装与配置/</id>
    <published>2020-05-28T06:53:33.000Z</published>
    <updated>2020-05-29T02:20:35.927Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h1><p>参见：<a href="https://www.jianshu.com/p/1527af1c372c" target="_blank" rel="noopener">https://www.jianshu.com/p/1527af1c372c</a></p><h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p><code>vsftpd: version 3.0.2</code>、<code>CentOS7</code></p><h2 id="FTP传输模式"><a href="#FTP传输模式" class="headerlink" title="FTP传输模式"></a>FTP传输模式</h2><p>文件传输协议（File Transfer Protocol，FTP），基于该协议FTP客户端与服务端可以实现共享文件、上传文件、下载文件。<br>FTP基于C/S模式，FTP客户端与服务器端有两种传输模式，分别是FTP主动模式、FTP被动模式。主被动模式均是以FTP服务器端为参照。</p><ul><li><p><strong>FTP主动模式：</strong>客户端从一个任意的端口N（N&gt;1024）连接到FTP服务器的port 21命令端口，客户端开始监听端口N+1，并发送FTP命令“port N+1”到FTP服务器，FTP服务器以数据端口（20）连接到客户端指定的数据端口（N+1）</p><p><img src="/img/ftp主动模式.png" alt=""></p></li><li><p><strong>FTP被动模式：</strong>客户端从一个任意的端口N（N&gt;1024）连接到FTP服务器的port 21命令端口，客户端开始监听端口N+1，客户端提交 PASV命令，服务器会开启一个任意的端口（P &gt;1024），并发送PORT P命令给客户端。客户端发起从本地端口N+1到服务器的端口P的连接用来传送数据</p><p><img src="/img/ftp被动模式.png" alt=""></p></li></ul><p>在企业实际环境中，如果FTP客户端与FTP服务端均开放防火墙，FTP需以<code>主动模式</code>工作，这样只需要在FTP服务器端防火墙规则中，开放<code>20、21</code>端口即可。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>在linux环境下，使用最多的FTP服务端软件就是Vsftpd</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd</span><br></pre></td></tr></table></figure><h3 id="添加ftp用户"><a href="#添加ftp用户" class="headerlink" title="添加ftp用户"></a>添加ftp用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd ftpuser</span><br></pre></td></tr></table></figure><h3 id="给ftp用户添加密码"><a href="#给ftp用户添加密码" class="headerlink" title="给ftp用户添加密码"></a>给ftp用户添加密码</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passwd ftpuser</span><br><span class="line"><span class="comment"># 输入两次密码后修改密码</span></span><br></pre></td></tr></table></figure><h3 id="修改selinux"><a href="#修改selinux" class="headerlink" title="修改selinux"></a>修改selinux</h3><p>可能遇到的问题：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 出现以下错误</span></span><br><span class="line">setenforce: SELinux is disabled</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决方法</span></span><br><span class="line">说明selinux已经被彻底的关闭了</span><br><span class="line">如果需要重新开启selinux，请按下面步骤：</span><br><span class="line"></span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">更改为：SELINUX=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#必须重启linux，不重启是没办法立刻开启selinux的</span></span><br></pre></td></tr></table></figure><p>继续</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">getsebool -a | grep ftp</span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line">ftpd_anon_write --&gt; off</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; off</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这两个都off</span></span><br><span class="line">ftpd_full_access --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br><span class="line"><span class="comment"># 执行如下命令设置为on:</span></span><br><span class="line">setsebool -P ftpd_full_access on</span><br><span class="line">setsebool -P tftp_home_dir on</span><br></pre></td></tr></table></figure><p>再次执行<code>getsebool -a | grep ftp</code>看到那两个状态是on就行了</p><h3 id="关闭匿名访问"><a href="#关闭匿名访问" class="headerlink" title="关闭匿名访问"></a>关闭匿名访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认是YES，改成NO</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续在vsftp.conf文件【最下面】添加以下内容：（作用是设置FTP被动模式使用的端口范围）</span></span><br><span class="line">pasv_min_port=30000</span><br><span class="line">pasv_max_port=60999</span><br></pre></td></tr></table></figure><p>然后保存退出即可</p><h3 id="开启端口"><a href="#开启端口" class="headerlink" title="开启端口"></a>开启端口</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开20 21端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=20/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=21/tcp --permanent</span><br><span class="line"><span class="comment"># 打开上面FTP被动模式设置的端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=30000-60999/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h3 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">chkconfig vsftpd on</span><br></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start vsftpd</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>打开filezilla工具，输入虚拟机的ip，<code>20/21端口（不填也行，默认就是20/21）</code>，用户名和密码，点击快速连接，连接vsftp服务:</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/filezilla.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>如图所示则连接成功。</p><h2 id="配置nginx为图片服务器"><a href="#配置nginx为图片服务器" class="headerlink" title="配置nginx为图片服务器"></a>配置nginx为图片服务器</h2><p><strong>按照以上步骤安装好nginx和vsftp后，还是不能访问上传的图片的，需要进行如下配置:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/vsftp-nginx.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>按道理这样就可以了，但是我访问却报错:<br><strong>403 forbidden</strong>，最后发现是因为ftpuser文件夹没有可读权限，执行如下命令:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 授予普通用户文件夹及其子文件夹读写权限</span></span><br><span class="line">chmod -R 777 /home/ftpuser</span><br></pre></td></tr></table></figure><p>再次访问即可成功！</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/home-ftpuser.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h3><ul><li><p><code>/etc/vsftpd/vsftpd.conf</code>这个文件是vsftpd服务的核心配置文件！<br>我们在修改配置文件的时候，最好先备份一份！</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak</span><br></pre></td></tr></table></figure><p>我们先来了解一下里边可以配置的大致内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否允许匿名登录FTP服务器，默认设置为YES允许</span></span><br><span class="line"><span class="comment"># 用户可使用用户名ftp或anonymous进行ftp登录，口令为用户的E-mail地址。</span></span><br><span class="line"><span class="comment"># 如不允许匿名访问则设置为NO</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line"><span class="comment"># 是否允许本地用户(即linux系统中的用户帐号)登录FTP服务器，默认设置为YES允许</span></span><br><span class="line"><span class="comment"># 本地用户登录后会进入用户主目录，而匿名用户登录后进入匿名用户的下载目录/var/ftp/pub</span></span><br><span class="line"><span class="comment"># 若只允许匿名用户访问，前面加上#注释掉即可阻止本地用户访问FTP服务器</span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="comment"># 是否允许本地用户对FTP服务器文件具有写权限，默认设置为YES允许</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="comment"># 掩码，本地用户默认掩码为077</span></span><br><span class="line"><span class="comment"># 你可以设置本地用户的文件掩码为缺省022，也可根据个人喜好将其设置为其他值</span></span><br><span class="line">local_umask=022</span><br><span class="line"><span class="comment"># 是否允许匿名用户上传文件，须将全局的write_enable=YES。默认为YES</span></span><br><span class="line"><span class="comment">#anon_upload_enable=YES</span></span><br><span class="line"><span class="comment"># 是否允许匿名用户创建新文件夹</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES </span></span><br><span class="line"><span class="comment"># 是否激活目录欢迎信息功能</span></span><br><span class="line"><span class="comment"># 当用户用CMD模式首次访问服务器上某个目录时，FTP服务器将显示欢迎信息</span></span><br><span class="line"><span class="comment"># 默认情况下，欢迎信息是通过该目录下的.message文件获得的</span></span><br><span class="line"><span class="comment"># 此文件保存自定义的欢迎信息，由用户自己建立</span></span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"><span class="comment"># 是否让系统自动维护上传和下载的日志文件</span></span><br><span class="line"><span class="comment"># 默认情况该日志文件为/var/log/vsftpd.log,也可以通过下面的xferlog_file选项对其进行设定</span></span><br><span class="line"><span class="comment"># 默认值为NO</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="comment"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line"><span class="comment"># 是否设定FTP服务器将启用FTP数据端口的连接请求</span></span><br><span class="line"><span class="comment"># ftp-data数据传输，21为连接控制端口</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="comment"># 设定是否允许改变上传文件的属主，与下面一个设定项配合使用</span></span><br><span class="line"><span class="comment"># 注意，不推荐使用root用户上传文件</span></span><br><span class="line"><span class="comment">#chown_uploads=YES</span></span><br><span class="line"><span class="comment"># 设置想要改变的上传文件的属主，如果需要，则输入一个系统用户名</span></span><br><span class="line"><span class="comment"># 可以把上传的文件都改成root属主。whoever：任何人</span></span><br><span class="line"><span class="comment">#chown_username=whoever</span></span><br><span class="line"><span class="comment"># 设定系统维护记录FTP服务器上传和下载情况的日志文件</span></span><br><span class="line"><span class="comment"># /var/log/vsftpd.log是默认的，也可以另设其它</span></span><br><span class="line"><span class="comment">#xferlog_file=/var/log/vsftpd.log</span></span><br><span class="line"><span class="comment"># 是否以标准xferlog的格式书写传输日志文件</span></span><br><span class="line"><span class="comment"># 默认为/var/log/xferlog，也可以通过xferlog_file选项对其进行设定</span></span><br><span class="line"><span class="comment"># 默认值为NO</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line"><span class="comment"># 以下是附加配置，添加相应的选项将启用相应的设置</span></span><br><span class="line"><span class="comment"># 是否生成两个相似的日志文件</span></span><br><span class="line"><span class="comment"># 默认在/var/log/xferlog和/var/log/vsftpd.log目录下</span></span><br><span class="line"><span class="comment"># 前者是wu_ftpd类型的传输日志，可以利用标准日志工具对其进行分析；后者是vsftpd类型的日志</span></span><br><span class="line"><span class="comment">#dual_log_enable</span></span><br><span class="line"><span class="comment"># 是否将原本输出到/var/log/vsftpd.log中的日志，输出到系统日志</span></span><br><span class="line"><span class="comment">#syslog_enable</span></span><br><span class="line"><span class="comment"># 设置数据传输中断间隔时间，此语句表示空闲的用户会话中断时间为600秒</span></span><br><span class="line"><span class="comment"># 即当数据传输结束后，用户连接FTP服务器的时间不应超过600秒。可以根据实际情况对该值进行修改</span></span><br><span class="line"><span class="comment">#idle_session_timeout=600</span></span><br><span class="line"><span class="comment"># 设置数据连接超时时间，该语句表示数据连接超时时间为120秒，可根据实际情况对其个修改</span></span><br><span class="line"><span class="comment">#data_connection_timeout=120</span></span><br><span class="line"><span class="comment"># 运行vsftpd需要的非特权系统用户，缺省是nobody</span></span><br><span class="line"><span class="comment">#nopriv_user=ftpsecure</span></span><br><span class="line"><span class="comment"># 是否识别异步ABOR请求。</span></span><br><span class="line"><span class="comment"># 如果FTP client会下达“async ABOR”这个指令时，这个设定才需要启用</span></span><br><span class="line"><span class="comment"># 而一般此设定并不安全，所以通常将其取消</span></span><br><span class="line"><span class="comment">#async_abor_enable=YES</span></span><br><span class="line"><span class="comment"># 是否以ASCII方式传输数据。默认情况下，服务器会忽略ASCII方式的请求。</span></span><br><span class="line"><span class="comment"># 启用此选项将允许服务器以ASCII方式传输数据</span></span><br><span class="line"><span class="comment"># 不过，这样可能会导致由"SIZE /big/file"方式引起的DoS攻击</span></span><br><span class="line"><span class="comment">#ascii_upload_enable=YES</span></span><br><span class="line"><span class="comment">#ascii_download_enable=YES</span></span><br><span class="line"><span class="comment"># 登录FTP服务器时显示的欢迎信息</span></span><br><span class="line"><span class="comment"># 如有需要，可在更改目录欢迎信息的目录下创建名为.message的文件，并写入欢迎信息保存后</span></span><br><span class="line"><span class="comment">#ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="comment"># 黑名单设置。如果很讨厌某些email address，就可以使用此设定来取消他的登录权限</span></span><br><span class="line"><span class="comment"># 可以将某些特殊的email address抵挡住。</span></span><br><span class="line"><span class="comment">#deny_email_enable=YES</span></span><br><span class="line"><span class="comment"># 当上面的deny_email_enable=YES时，可以利用这个设定项来规定哪些邮件地址不可登录vsftpd服务器</span></span><br><span class="line"><span class="comment"># 此文件需用户自己创建，一行一个email address即可</span></span><br><span class="line"><span class="comment">#banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="comment"># 用户登录FTP服务器后是否具有访问自己目录以外的其他文件的权限</span></span><br><span class="line"><span class="comment"># 设置为YES时，用户被锁定在自己的home目录中，vsftpd将在下面chroot_list_file选项值的位置寻找chroot_list文件</span></span><br><span class="line"><span class="comment"># 必须与下面的设置项配合</span></span><br><span class="line"><span class="comment">#chroot_list_enable=YES</span></span><br><span class="line"><span class="comment"># 被列入此文件的用户，在登录后将不能切换到自己目录以外的其他目录</span></span><br><span class="line"><span class="comment"># 从而有利于FTP服务器的安全管理和隐私保护。此文件需自己建立</span></span><br><span class="line"><span class="comment">#chroot_list_file=/etc/vsftpd/chroot_list</span></span><br><span class="line"><span class="comment"># 是否允许递归查询。默认为关闭，以防止远程用户造成过量的I/O</span></span><br><span class="line"><span class="comment">#ls_recurse_enable=YES</span></span><br><span class="line"><span class="comment"># 是否允许监听。</span></span><br><span class="line"><span class="comment"># 如果设置为YES，则vsftpd将以独立模式运行，由vsftpd自己监听和处理IPv4端口的连接请求</span></span><br><span class="line">listen=NO</span><br><span class="line"><span class="comment"># 设定是否支持IPV6。如要同时监听IPv4和IPv6端口，</span></span><br><span class="line"><span class="comment"># 则必须运行两套vsftpd，采用两套配置文件</span></span><br><span class="line"><span class="comment"># 同时确保其中有一个监听选项是被注释掉的</span></span><br><span class="line">listen_ipv6=YES</span><br><span class="line"><span class="comment"># 设置PAM外挂模块提供的认证服务所使用的配置文件名，即/etc/pam.d/vsftpd文件</span></span><br><span class="line"><span class="comment"># 此文件中file=/etc/vsftpd/ftpusers字段，说明了PAM模块能抵挡的帐号内容来自文件/etc/vsftpd/ftpusers中</span></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="comment"># 是否允许ftpusers文件中的用户登录FTP服务器，默认为NO</span></span><br><span class="line"><span class="comment"># 若此项设为YES，则user_list文件中的用户允许登录FTP服务器</span></span><br><span class="line"><span class="comment"># 而如果同时设置了userlist_deny=YES，则user_list文件中的用户将不允许登录FTP服务器，甚至连输入密码提示信息都没有</span></span><br><span class="line">userlist_enable=YES</span><br><span class="line"><span class="comment"># 是否使用tcp_wrappers作为主机访问控制方式。</span></span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure></li><li><p><code>/etc/vsftpd/ftpusers</code>这个文件是禁止使用vsftpd的用户列表文件。记录不允许访问FTP服务器的用户名单，管理员可以把一些对系统安全有威胁的用户账号记录在此文件中，以免用户从FTP登录后获得大于上传下载操作的权利，而对系统造成损坏</p></li><li><p><code>/etc/vsftpd/user_list</code>这个文件禁止或允许使用vsftpd的用户列表文件。这个文件中指定的用户缺省情况（即在/etc/vsftpd/vsftpd.conf中设置userlist_deny=YES）下也不能访问FTP服务器，在设置了userlist_deny=NO时,仅允许user_list中指定的用户访问FTP服务器</p></li></ul><h1 id="复杂"><a href="#复杂" class="headerlink" title="复杂"></a>复杂</h1><p>参见：<a href="https://blog.csdn.net/aiynmimi/article/details/77012507" target="_blank" rel="noopener">https://blog.csdn.net/aiynmimi/article/details/77012507</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;简单&quot;&gt;&lt;a href=&quot;#简单&quot; class=&quot;headerlink&quot; title=&quot;简单&quot;&gt;&lt;/a&gt;简单&lt;/h1&gt;&lt;p&gt;参见：&lt;a href=&quot;https://www.jianshu.com/p/1527af1c372c&quot; target=&quot;_blank&quot; re
      
    
    </summary>
    
      <category term="vsftp" scheme="/categories/vsftp/"/>
    
    
      <category term="搭建" scheme="/tags/%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>判断日期是工作日周末还是节假日</title>
    <link href="/2020/05/18/%E5%88%A4%E6%96%AD%E6%97%A5%E6%9C%9F%E6%98%AF%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%91%A8%E6%9C%AB%E8%BF%98%E6%98%AF%E8%8A%82%E5%81%87%E6%97%A5/"/>
    <id>/2020/05/18/判断日期是工作日周末还是节假日/</id>
    <published>2020-05-18T07:02:45.000Z</published>
    <updated>2020-05-18T11:48:15.056Z</updated>
    
    <content type="html"><![CDATA[<h2 id="要实现该功能需要两步"><a href="#要实现该功能需要两步" class="headerlink" title="要实现该功能需要两步"></a>要实现该功能需要两步</h2><h3 id="第一步，配置“班”和“休”"><a href="#第一步，配置“班”和“休”" class="headerlink" title="第一步，配置“班”和“休”"></a>第一步，配置“班”和“休”</h3><p>由于每年“班”和“休”对应的日期都不一样（依据：<a href="http://www.gov.cn/zhengce/content/2019-11/21/content_5454164.htm" target="_blank" rel="noopener">国务院办公厅关于2020年部分节假日安排的通知</a>），没法做到完全自动化，必须手动配置</p><p>我们将“班”和“休的日期分别配置到<code>/data</code>目录下的<code>2020_w.txt</code>和<code>2020.txt</code>文件：</p><ul><li><p><code>2020_w.txt（班）</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0119</span><br><span class="line">0426</span><br><span class="line">0509</span><br><span class="line">0628</span><br><span class="line">0927</span><br><span class="line">1010</span><br></pre></td></tr></table></figure></li><li><p><code>2020.txt（休）</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">0101</span><br><span class="line">0124</span><br><span class="line">0125</span><br><span class="line">0126</span><br><span class="line">0127</span><br><span class="line">0128</span><br><span class="line">0129</span><br><span class="line">0130</span><br><span class="line">0131</span><br><span class="line">0201</span><br><span class="line">0202</span><br><span class="line">0404</span><br><span class="line">0405</span><br><span class="line">0406</span><br><span class="line">0501</span><br><span class="line">0502</span><br><span class="line">0503</span><br><span class="line">0504</span><br><span class="line">0505</span><br><span class="line">0625</span><br><span class="line">0626</span><br><span class="line">0627</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br></pre></td></tr></table></figure></li></ul><p>如何快速查看某天是“班”还是“休”</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/calendar.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="第二步，功能代码"><a href="#第二步，功能代码" class="headerlink" title="第二步，功能代码"></a>第二步，功能代码</h3><p><code>废话不多说，直接上代码：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断日期是工作日周末还是节假日</span></span><br><span class="line"><span class="comment"> * 工作日对应结果为 0, 节假日对应的结果为 1, 周末（周六、日）对应结果为 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChineseHolidayUtil</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> DateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line"><span class="comment">// 存放“休”和“班”的日期key和对应不同的value（0=班、1=休）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Map&lt;Date, Integer&gt; holidayBuffer = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="comment">// 存放文件全路径（包含文件名）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> List&lt;File&gt; dataPath = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// data文件夹的全路径（data下存放配置好的“班”和“休”的文件）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String storDataPath = <span class="string">"**/common/data"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化holidayBuffer</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        getFilePath(<span class="keyword">new</span> File(storDataPath));</span><br><span class="line">        <span class="keyword">if</span> (dataPath.size() != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 存放每一行的数据</span></span><br><span class="line">        String temp = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (File f : dataPath) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(f));</span><br><span class="line">                    <span class="keyword">while</span> ((temp = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!temp.equals(<span class="string">"\n"</span>)) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (f.getName().matches(<span class="string">"[2][0][2][0-9]_w.txt"</span>))<span class="comment">// 班</span></span><br><span class="line">                            holidayBuffer.put(holidayToDate(f, temp), <span class="number">0</span>);</span><br><span class="line">                            <span class="keyword">else</span> <span class="keyword">if</span>(f.getName().matches(<span class="string">"[2][0][2][0-9].txt"</span>))<span class="comment">// 休</span></span><br><span class="line">                            holidayBuffer.put(holidayToDate(f, temp), <span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException | ParseException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断某一天是否是周末</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> d</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isWeekend</span><span class="params">(Date d)</span> </span>&#123;</span><br><span class="line">        Calendar cal = Calendar.getInstance();</span><br><span class="line">        cal.setTime(d);</span><br><span class="line">        <span class="keyword">return</span> (cal.get(Calendar.DAY_OF_WEEK) == Calendar.SATURDAY </span><br><span class="line">                || cal.get(Calendar.DAY_OF_WEEK) == Calendar.SUNDAY);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将路径下的所有文件“全路径”添加到“dataPath”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getFilePath</span> <span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(file.isDirectory())&#123;</span><br><span class="line">            File f[]= file.listFiles();</span><br><span class="line">            <span class="keyword">if</span>(f!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (File aF : f) &#123;</span><br><span class="line">                    getFilePath(aF);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dataPath.add(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造（拼接）日期（格式：yyyy-MM-dd）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> f</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Date <span class="title">holidayToDate</span><span class="params">(File f, String s)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        String fileName = f.getName();</span><br><span class="line">        <span class="keyword">return</span> format.parse(fileName.split(<span class="string">"\\_|\\."</span>)[<span class="number">0</span>] + <span class="string">"-"</span> + s.substring(<span class="number">0</span>,<span class="number">2</span>) </span><br><span class="line">                            + <span class="string">"-"</span> + s.substring(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取某天是什么日子（工作日、节日、周末）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> d 日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0工作日 1节日  2周末</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">getHoliday</span><span class="params">(Date d)</span> </span>&#123;</span><br><span class="line">    System.out.println(d);</span><br><span class="line">        <span class="keyword">if</span> (holidayBuffer.containsKey(d)) &#123;</span><br><span class="line">            <span class="keyword">return</span> holidayBuffer.get(d);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> isWeekend(d) ? <span class="number">2</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试一手</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">System.out.println(getHoliday(format.parse(format.format(<span class="keyword">new</span> Date()))));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;要实现该功能需要两步&quot;&gt;&lt;a href=&quot;#要实现该功能需要两步&quot; class=&quot;headerlink&quot; title=&quot;要实现该功能需要两步&quot;&gt;&lt;/a&gt;要实现该功能需要两步&lt;/h2&gt;&lt;h3 id=&quot;第一步，配置“班”和“休”&quot;&gt;&lt;a href=&quot;#第一步，配置“班
      
    
    </summary>
    
      <category term="Java" scheme="/categories/Java/"/>
    
    
      <category term="判断某天是工作日周末还是节假日" scheme="/tags/%E5%88%A4%E6%96%AD%E6%9F%90%E5%A4%A9%E6%98%AF%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%91%A8%E6%9C%AB%E8%BF%98%E6%98%AF%E8%8A%82%E5%81%87%E6%97%A5/"/>
    
  </entry>
  
  <entry>
    <title>安装Licode</title>
    <link href="/2020/02/11/%E5%AE%89%E8%A3%85Licode/"/>
    <id>/2020/02/11/安装Licode/</id>
    <published>2020-02-11T03:37:42.000Z</published>
    <updated>2020-02-13T01:44:38.597Z</updated>
    
    <content type="html"><![CDATA[<h2 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h2><p>操作系统ubuntu18.04 LTS（root登录，否则手动给权限sudo）</p><h2 id="克隆Licode代码"><a href="#克隆Licode代码" class="headerlink" title="克隆Licode代码"></a>克隆Licode代码</h2><p>您首先需要从github克隆我们的代码。</p><p>您需要在计算机中安装git</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p> 现在克隆存储库并进入<code>licode/</code>文件夹（也可以先在本地下载好传输到服务器）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ging/licode.git</span><br><span class="line"><span class="built_in">cd</span> licode</span><br></pre></td></tr></table></figure><p> <code>下面使用的所有脚本都包含在从github克隆的代码中</code> </p><h2 id="安装依赖项"><a href="#安装依赖项" class="headerlink" title="安装依赖项"></a>安装依赖项</h2><p> 现在，您需要安装一些依赖项才能使用Licode </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提：需要安装git</span></span><br><span class="line">./scripts/installUbuntuDeps.sh</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/licode001.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="安装Licode"><a href="#安装Licode" class="headerlink" title="安装Licode"></a>安装Licode</h2><p>此步骤将安装所有Licode组件。</p><p>这些组件是：<code>Erizo，Erizo API，Erizo Controller和Nuve</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提：需要安装conan</span></span><br><span class="line">apt install python3-pip</span><br><span class="line">pip3 install conan</span><br><span class="line"><span class="comment">## 安装erizo</span></span><br><span class="line">./scripts/installErizo.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前提：需要安装Cmake、mongodb</span></span><br><span class="line">apt install cmake</span><br><span class="line">apt install mongodb-clients</span><br><span class="line">apt install mongodb-server-core</span><br><span class="line"><span class="comment">## 安装nuve</span></span><br><span class="line">./scripts/installNuve.sh</span><br></pre></td></tr></table></figure><h2 id="安装基本示例"><a href="#安装基本示例" class="headerlink" title="安装基本示例"></a>安装基本示例</h2><p> 此步骤将安装一个基本的测试示例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/installBasicExample.sh</span><br></pre></td></tr></table></figure><h2 id="测试Licode"><a href="#测试Licode" class="headerlink" title="测试Licode"></a>测试Licode</h2><p> 目前，您已经在计算机中安装了Licode和一个基本的视频会议示例以对其进行测试。让我们运行它们 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此步骤将初始化所有Licode组件</span></span><br><span class="line">./scripts/initLicode.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此步骤将初始化基本示例</span></span><br><span class="line">./scripts/initBasicExample.sh</span><br></pre></td></tr></table></figure><p> 现在，您可以连接到“ localhost:3001”并测试您的基本视频会议示例！ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;准备环境&quot;&gt;&lt;a href=&quot;#准备环境&quot; class=&quot;headerlink&quot; title=&quot;准备环境&quot;&gt;&lt;/a&gt;准备环境&lt;/h2&gt;&lt;p&gt;操作系统ubuntu18.04 LTS（root登录，否则手动给权限sudo）&lt;/p&gt;
&lt;h2 id=&quot;克隆Licode代码
      
    
    </summary>
    
      <category term="Licode" scheme="/categories/Licode/"/>
    
    
      <category term="安装" scheme="/tags/%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>南生论坛页面静态展示v2.6</title>
    <link href="/2020/01/06/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%B1%95%E7%A4%BAv2-6/"/>
    <id>/2020/01/06/南生论坛页面静态展示v2-6/</id>
    <published>2020-01-06T13:34:33.000Z</published>
    <updated>2020-04-14T03:42:34.476Z</updated>
    
    <content type="html"><![CDATA[<p><strong>注：</strong><code>以下截图是v2.6的界面样子</code></p><h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><h4 id="南生论坛v2-6"><a href="#南生论坛v2-6" class="headerlink" title="南生论坛v2.6"></a>南生论坛v2.6</h4><p><code>在v2.0的基础上：</code>支持Markdown、新增分享功能、新增文章详情页面、首页文章显示简约化</p><h3 id="适用人员"><a href="#适用人员" class="headerlink" title="适用人员"></a>适用人员</h3><h4 id="南生论坛v2-6-1"><a href="#南生论坛v2-6-1" class="headerlink" title="南生论坛v2.6"></a>南生论坛v2.6</h4><p>该版本适用于<code>初学</code>ssm框架、对jQuery和ajax<code>有一定熟悉度</code>、并且想以<code>Markdown形式写文章</code>的童鞋使用，主要可以通过该项目了解整个项目的设计思路（让<code>心怀大志</code>、<code>无从下手</code>的你找到突破口）</p><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><h4 id="南生论坛v2-6-2"><a href="#南生论坛v2-6-2" class="headerlink" title="南生论坛v2.6"></a>南生论坛v2.6</h4><p>注释十分详细、逻辑清晰、界面简洁美观、功能较完善、ECharts图表化展示、人机交互、异步加载、分页加载、统计记录、相册相片、支持Markdown、支持QQ分享文章、文章显示更加合理化（首页等展示文章的缩略信息-<code>可以提高文章的展示数量</code>；新增文章详情页面-<code>有利于读者专心于该文章而不被其它信息干扰</code>）</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>代码冗余度较高、命名不是很规范</p><h3 id="用户系统-展示"><a href="#用户系统-展示" class="headerlink" title="用户系统-展示"></a>用户系统-展示</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-登录v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-登录v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-注册v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-注册v2.6.jpg" alt="image" width="50%;" align="center/"></p><h4 id="首页-登录前"><a href="#首页-登录前" class="headerlink" title="首页-登录前"></a>首页-登录前</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-首页-登录前v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-首页-登录前v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="首页-登录后"><a href="#首页-登录后" class="headerlink" title="首页-登录后"></a>首页-登录后</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-首页-登陆后v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-首页-登录后v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-写文章v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-写文章v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="修改文章"><a href="#修改文章" class="headerlink" title="修改文章"></a>修改文章</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-修改文章v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-修改文章v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="文章详情"><a href="#文章详情" class="headerlink" title="文章详情"></a>文章详情</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-文章详情v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-文章详情v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="个人主页"><a href="#个人主页" class="headerlink" title="个人主页"></a>个人主页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-个人主页v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-个人主页v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="他人主页"><a href="#他人主页" class="headerlink" title="他人主页"></a>他人主页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-他人主页v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-他人主页v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="编辑个人资料"><a href="#编辑个人资料" class="headerlink" title="编辑个人资料"></a>编辑个人资料</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-编辑个人资料v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-编辑个人资料v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="基本信息设置"><a href="#基本信息设置" class="headerlink" title="基本信息设置"></a>基本信息设置</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-基本信息设置v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-基本信息设置v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-上传头像v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-修改头像v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-动态v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-动态v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="回答"><a href="#回答" class="headerlink" title="回答"></a>回答</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-回答v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-回答v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="关注"><a href="#关注" class="headerlink" title="关注"></a>关注</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-关注v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-关注v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="收藏"><a href="#收藏" class="headerlink" title="收藏"></a>收藏</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-收藏v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-收藏v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-相册v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-相册v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="有照片的相册"><a href="#有照片的相册" class="headerlink" title="有照片的相册"></a>有照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-有v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-有照片的相册v2.6.jpg" alt="image" width="50%;" align="center"></p><h4 id="无照片的相册"><a href="#无照片的相册" class="headerlink" title="无照片的相册"></a>无照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-无v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-无照片的相册v2.6.jpg" alt="image" width="50%;" align="center"></p><h3 id="管理员系统-展示"><a href="#管理员系统-展示" class="headerlink" title="管理员系统-展示"></a>管理员系统-展示</h3><h4 id="登录-1"><a href="#登录-1" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-登录v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="初始页面"><a href="#初始页面" class="headerlink" title="初始页面"></a>初始页面</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-初始页面v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-用户管理v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="文章管理"><a href="#文章管理" class="headerlink" title="文章管理"></a>文章管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-文章管理v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="版块管理"><a href="#版块管理" class="headerlink" title="版块管理"></a>版块管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-版块管理v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="访问记录"><a href="#访问记录" class="headerlink" title="访问记录"></a>访问记录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-访问记录v2.6.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;注：&lt;/strong&gt;&lt;code&gt;以下截图是v2.6的界面样子&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;功能说明&quot;&gt;&lt;a href=&quot;#功能说明&quot; class=&quot;headerlink&quot; title=&quot;功能说明&quot;&gt;&lt;/a&gt;功能说明&lt;/h3&gt;&lt;h4 id=&quot;南生论
      
    
    </summary>
    
      <category term="南生论坛" scheme="/categories/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B/"/>
    
    
      <category term="展示" scheme="/tags/%E5%B1%95%E7%A4%BA/"/>
    
  </entry>
  
  <entry>
    <title>南生论坛页面静态展示</title>
    <link href="/2019/12/19/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%B1%95%E7%A4%BA/"/>
    <id>/2019/12/19/南生论坛页面静态展示/</id>
    <published>2019-12-19T01:20:43.000Z</published>
    <updated>2020-04-14T03:42:19.013Z</updated>
    
    <content type="html"><![CDATA[<p><strong>注：</strong><code>以下截图是v1.0和v2.0的界面样子</code></p><h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><h4 id="南生论坛v1-0"><a href="#南生论坛v1-0" class="headerlink" title="南生论坛v1.0"></a>南生论坛v1.0</h4><p>登录【<a href="http://www.nanshengbbs.top/" target="_blank" rel="noopener">用户系统</a>】可以：发帖、修改帖子、删除帖子、评论、删除评论、修改个人信息、关注、收藏<br>登录【<a href="http://www.nanshengbbs.top/admin" target="_blank" rel="noopener">管理系统</a>】可以：管理用户、管理帖子、管理板块、访问记录</p><h4 id="南生论坛v2-0"><a href="#南生论坛v2-0" class="headerlink" title="南生论坛v2.0"></a>南生论坛v2.0</h4><p><code>在v1.0的基础上：</code>整体异步实现、新增统计饼图、优化人机交互、实现分页、实现相册功能、实现月周日访问记录（方便管理员了解该论坛的访问情况）</p><h3 id="适用人员"><a href="#适用人员" class="headerlink" title="适用人员"></a>适用人员</h3><h4 id="南生论坛v1-0-1"><a href="#南生论坛v1-0-1" class="headerlink" title="南生论坛v1.0"></a>南生论坛v1.0</h4><p>该版本适用于<code>初学</code>ssm框架的童鞋，主要可以通过该项目了解整个项目的设计思路（让<code>心怀大志</code>、<code>无从下手</code>的你找到突破口）</p><h4 id="南生论坛v2-0-1"><a href="#南生论坛v2-0-1" class="headerlink" title="南生论坛v2.0"></a>南生论坛v2.0</h4><p>该版本适用于<code>初学</code>ssm框架、并且对jQuery和ajax<code>有一定熟悉度</code>的童鞋使用，主要可以通过该项目了解整个项目的设计思路（让<code>心怀大志</code>、<code>无从下手</code>的你找到突破口）</p><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><h4 id="南生论坛v1-0-2"><a href="#南生论坛v1-0-2" class="headerlink" title="南生论坛v1.0"></a>南生论坛v1.0</h4><p>注释十分详细、逻辑清晰、界面简洁美观、功能较完善</p><h4 id="南生论坛v2-0-2"><a href="#南生论坛v2-0-2" class="headerlink" title="南生论坛v2.0"></a>南生论坛v2.0</h4><p>注释十分详细、逻辑清晰、界面简洁美观、功能较完善、ECharts图表化展示、人机交互、异步加载、分页加载、统计记录、相册相片</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>代码冗余度较高、命名不是很规范</p><h3 id="用户系统-展示"><a href="#用户系统-展示" class="headerlink" title="用户系统-展示"></a>用户系统-展示</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-登录2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-登录.jpg" alt="image" width="50%;" align="center"></p><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-注册.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-注册.jpg" alt="image" width="50%;" align="center/"></p><h4 id="首页-登录前"><a href="#首页-登录前" class="headerlink" title="首页-登录前"></a>首页-登录前</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-首页-登录前.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-首页-登录前.jpg" alt="image" width="50%;" align="center"></p><h4 id="首页-登录后"><a href="#首页-登录后" class="headerlink" title="首页-登录后"></a>首页-登录后</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-首页-登陆后.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-首页-登录后.jpg" alt="image" width="50%;" align="center"></p><h4 id="发帖"><a href="#发帖" class="headerlink" title="发帖"></a>发帖</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-发帖2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-发帖.jpg" alt="image" width="50%;" align="center"></p><h4 id="个人主页"><a href="#个人主页" class="headerlink" title="个人主页"></a>个人主页</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-个人主页2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-个人主页.jpg" alt="image" width="50%;" align="center"></p><h4 id="编辑个人资料"><a href="#编辑个人资料" class="headerlink" title="编辑个人资料"></a>编辑个人资料</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-编辑个人资料2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-编辑个人资料.jpg" alt="image" width="50%;" align="center"></p><h4 id="基本信息设置"><a href="#基本信息设置" class="headerlink" title="基本信息设置"></a>基本信息设置</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-基本信息设置2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-基本信息设置.jpg" alt="image" width="50%;" align="center"></p><h4 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-上传头像2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-修改头像.jpg" alt="image" width="50%;" align="center"></p><h4 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-动态.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-动态.jpg" alt="image" width="50%;" align="center"></p><h4 id="回答"><a href="#回答" class="headerlink" title="回答"></a>回答</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-回答.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-回复.jpg" alt="image" width="50%;" align="center"></p><h4 id="关注"><a href="#关注" class="headerlink" title="关注"></a>关注</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-关注.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-关注.jpg" alt="image" width="50%;" align="center"></p><h4 id="收藏"><a href="#收藏" class="headerlink" title="收藏"></a>收藏</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-收藏.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-收藏.jpg" alt="image" width="50%;" align="center"></p><h4 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-相册.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-相册.jpg" alt="image" width="50%;" align="center"></p><h4 id="有照片的相册"><a href="#有照片的相册" class="headerlink" title="有照片的相册"></a>有照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-有.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-有照片的相册.jpg" alt="image" width="50%;" align="center"></p><h4 id="无照片的相册"><a href="#无照片的相册" class="headerlink" title="无照片的相册"></a>无照片的相册</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/用户-照片-无.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><p><code>手机上的效果：</code></p><p><img src="/img/手机-无照片的相册.jpg" alt="image" width="50%;" align="center"></p><h3 id="管理员系统-展示"><a href="#管理员系统-展示" class="headerlink" title="管理员系统-展示"></a>管理员系统-展示</h3><h4 id="登录-1"><a href="#登录-1" class="headerlink" title="登录"></a>登录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-登录2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="初始页面"><a href="#初始页面" class="headerlink" title="初始页面"></a>初始页面</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-初始页面.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-用户管理2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="帖子管理"><a href="#帖子管理" class="headerlink" title="帖子管理"></a>帖子管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-帖子管理2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="版块管理"><a href="#版块管理" class="headerlink" title="版块管理"></a>版块管理</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-版块管理2.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure><h4 id="访问记录"><a href="#访问记录" class="headerlink" title="访问记录"></a>访问记录</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/管理员-访问记录.png" alt="image" title="">                </div>                <div class="image-caption">image</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;注：&lt;/strong&gt;&lt;code&gt;以下截图是v1.0和v2.0的界面样子&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;功能说明&quot;&gt;&lt;a href=&quot;#功能说明&quot; class=&quot;headerlink&quot; title=&quot;功能说明&quot;&gt;&lt;/a&gt;功能说明&lt;/h3&gt;&lt;h4 id
      
    
    </summary>
    
      <category term="南生论坛" scheme="/categories/%E5%8D%97%E7%94%9F%E8%AE%BA%E5%9D%9B/"/>
    
    
      <category term="展示" scheme="/tags/%E5%B1%95%E7%A4%BA/"/>
    
  </entry>
  
  <entry>
    <title>Chrome插件</title>
    <link href="/2019/11/26/Chrome%E6%8F%92%E4%BB%B6/"/>
    <id>/2019/11/26/Chrome插件/</id>
    <published>2019-11-26T06:25:24.000Z</published>
    <updated>2019-11-26T06:32:26.695Z</updated>
    
    <content type="html"><![CDATA[<p><code>完全引用</code>：<a href="https://zhaoolee.com/ChromeAppHeroes/" target="_blank" rel="noopener">https://zhaoolee.com/ChromeAppHeroes/</a></p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="https://www.v2fy.com/p/061-image-assistant/" target="_blank" rel="noopener">061《ImageAssistant》图片助手批量图片下载器</a></li><li><a href="https://www.v2fy.com/p/060_tabagotchi/" target="_blank" rel="noopener">060《Tabagotchi》为减缓全球变暖做出贡献</a></li><li><a href="https://www.v2fy.com/p/059_page_speed_insight_and_check_list/" target="_blank" rel="noopener">059《PageSpeed Insight and CheckList》为网页优化提供建议和量化指标</a></li><li><a href="https://www.v2fy.com/p/058_ip_address/" target="_blank" rel="noopener">058《IP-Address》快速查看当前设备IP</a></li><li><a href="https://www.v2fy.com/p/057_webp_save_as_png/" target="_blank" rel="noopener">057《图片另存为JPG/PNG/WebP》让WebP图片下载为PNG格式</a></li><li><a href="https://www.v2fy.com/p/056_search/" target="_blank" rel="noopener">056《Search》为Chrome设置搜索引擎关键词</a></li><li><a href="https://www.v2fy.com/p/055_keylines/" target="_blank" rel="noopener">055《Keylines》为网页元素添加随机描边颜色</a> | <a href="https://zhaoolee.com/ChromeAppHeroes/page/055_keylines.html" target="_blank" rel="noopener">备用链接</a></li><li><a href="https://www.v2fy.com/p/054_er_xiang_yi_tu_sou_tu/" target="_blank" rel="noopener">054《二箱 以图搜图》让你在搜图方面随心所欲（为所欲为）</a></li><li><a href="https://www.v2fy.com/p/053_shu_biao_dian_ji_te_xiao/" target="_blank" rel="noopener">053《鼠标点击特效 (๑•́ ∀ •̀๑)》为鼠标点击添加有趣的特效</a></li><li><p><a href="https://www.v2fy.com/p/052_site_palette/" target="_blank" rel="noopener">052《Site Palette》自动提取网站配色</a></p></li><li><p><a href="https://www.v2fy.com/p/051_custom_cursor_for_chrome/" target="_blank" rel="noopener">051《Custom Cursor for Chrome™》为Chrome换上可爱初音光标</a></p></li><li><a href="https://www.v2fy.com/p/050_google_results_previewer/" target="_blank" rel="noopener">050《Google Results Previewer》无点击查看谷歌搜索结果</a></li><li><a href="https://www.v2fy.com/p/049_web_server_for_chrome/" target="_blank" rel="noopener">049《Web Server for Chrome》搭建本地Web服务器, 实现局域网共享文件夹</a></li><li><a href="https://www.v2fy.com/p/048_words_discoverer/" target="_blank" rel="noopener">048《Words Discoverer》高亮标注单词,提升你的词汇量</a></li><li><a href="https://www.v2fy.com/p/047_go_to_tab/" target="_blank" rel="noopener">047《Go to Tab》快速跳转到打开的网页</a></li><li><a href="https://www.v2fy.com/p/046_whatfont/" target="_blank" rel="noopener">046《WhatFont》字体爱好者优雅查看网页字体</a></li><li><a href="https://www.v2fy.com/p/045_restlet_client/" target="_blank" rel="noopener">045《Restlet Client》优秀的Api测试工具</a></li><li><a href="https://www.v2fy.com/p/044_gu_ge_fang_wen_zhu_shou/" target="_blank" rel="noopener">044《谷歌访问助手》访问Chrome商店 Gmail 谷歌搜索</a></li><li><a href="https://www.v2fy.com/p/043_dream_afar_new_tab/" target="_blank" rel="noopener">043《Dream Afar New Tab》探索世界的新方式</a></li><li><a href="https://www.v2fy.com/p/042_edge/" target="_blank" rel="noopener">042 在Edge中安装Chrome扩展程序</a></li><li><a href="https://www.v2fy.com/p/041_copy_all_urls/" target="_blank" rel="noopener">041《Copy All Urls》优雅地保存-开启多个标签页</a></li><li><a href="https://www.v2fy.com/p/040_gitzip_for_github/" target="_blank" rel="noopener">040《GitZip for github》从Github批量下载表情包</a></li><li><a href="https://www.v2fy.com/p/039_simplify_gmail/" target="_blank" rel="noopener">039《Simplify Gmail》让网页版Gmail更清爽</a></li><li><a href="https://www.v2fy.com/p/038_alexa_traffic_rank/" target="_blank" rel="noopener">038《Alexa Traffic Rank》一键查看网站全球排名</a></li><li><a href="https://www.v2fy.com/p/037_saladict/" target="_blank" rel="noopener">037《Saladict》谷歌!有道!我全都要! 聚合词典, 并行翻译</a></li><li><a href="https://www.v2fy.com/p/036_screen_shader/" target="_blank" rel="noopener">036《Screen Shader》把网页调成暖色，你的眼睛会感谢你🙏</a></li><li><a href="https://www.v2fy.com/p/035_print_friendly_and_pdf/" target="_blank" rel="noopener">035《Print Friendly &amp; PDF》让你拥有最佳的打印阅读体验</a></li><li><a href="https://www.v2fy.com/p/034_astro_bot/" target="_blank" rel="noopener">034《Astro Bot》用新标签页刷编程题</a></li><li><a href="https://www.v2fy.com/p/033_yi_ye/" target="_blank" rel="noopener">033《一叶》在任意网页开启实时弹幕 聊天窗口 留言板</a></li><li><a href="https://www.v2fy.com/p/032_smallpdf/" target="_blank" rel="noopener">032《Smallpdf》简单好用的线上PDF工具</a></li><li><a href="https://www.v2fy.com/p/031_onetab/" target="_blank" rel="noopener">031《OneTab》把多个Tab转换为一个列表</a></li><li><a href="https://www.v2fy.com/p/030_jue_jin/" target="_blank" rel="noopener">030《掘金》相信优质技术内容的力量</a></li><li><a href="https://www.v2fy.com/p/029_simread/" target="_blank" rel="noopener">029 《SimpRead》为任意网页开启阅读模式</a></li><li><a href="https://www.v2fy.com/p/028_adblock/" target="_blank" rel="noopener">028《AdBlock》Adblock自定义屏蔽简书广告</a></li><li><a href="https://www.v2fy.com/p/027_text/" target="_blank" rel="noopener">027《Text》来自Chrome实验室的跨平台记事本</a></li><li><a href="https://www.v2fy.com/p/026_quickey_launcher/" target="_blank" rel="noopener">026《Quickey Launcher》打开网站只需一键</a></li><li><a href="https://www.v2fy.com/p/025_console/" target="_blank" rel="noopener">025《Console》Chrome自带好用的计算器</a></li><li><a href="https://www.v2fy.com/p/024_dark_reader/" target="_blank" rel="noopener">024《Dark Reader》为任意网站启用夜间模式</a></li><li><a href="https://www.v2fy.com/p/023_fireshot/" target="_blank" rel="noopener">023《FireShot》一键滚动截屏整个网页</a></li><li><a href="https://www.v2fy.com/p/022kuo_zhan_guan_li_qi/" target="_blank" rel="noopener">022《扩展管理器》管理你的Chrome扩展</a></li><li><a href="https://www.v2fy.com/p/021_bi_li_bi_li_zhu_shou/" target="_blank" rel="noopener">021《哔哩哔哩助手》助你快速成为B站老司机</a></li><li><a href="https://www.v2fy.com/p/020_boxel_rebound/" target="_blank" rel="noopener">020《Boxel Rebound》“嗨到中毒”的弹跳小方块(附自制赛道分享方法)</a></li><li><a href="https://www.v2fy.com/p/019_mega/" target="_blank" rel="noopener">019《MEGA》网盘可以良心到什么程度? 试试MEGA吧!</a></li><li><a href="https://www.v2fy.com/p/018_enhanced_github/" target="_blank" rel="noopener">018《Enhanced Github》从“冰柜”到“冰棍儿”,下载Github单个文件</a></li><li><p><a href="https://www.v2fy.com/p/017_xin_lang_wei_bo_tu_chuang/" target="_blank" rel="noopener">017《新浪微博图床》本地Markdown编写更流畅, 新浪微博图床来帮忙</a></p></li><li><p><a href="https://www.v2fy.com/p/016_jie_chu_b_zhan_qu_yu_xian_zhi/" target="_blank" rel="noopener">016《解除B站区域限制》查看进击的巨人第三季</a></p></li><li><a href="https://www.v2fy.com/p/015_xpath_helper/" target="_blank" rel="noopener">015 《XPath Helper》完成Bing每日壁纸的小爬虫</a></li><li><a href="https://www.v2fy.com/p/014_chao_ji_ma_li_ao_you_xi/" target="_blank" rel="noopener">014《超级马里奥游戏》Chrome变身小霸王</a></li><li><a href="https://www.v2fy.com/p/013_quick_qr/" target="_blank" rel="noopener">013《Quick QR》用二维码实现云粘贴</a></li><li><a href="https://www.v2fy.com/p/012_ourstickys/" target="_blank" rel="noopener">012《OurStickys》Chrome特色网页便签纸</a></li><li><a href="https://www.v2fy.com/p/011_whatruns/" target="_blank" rel="noopener">011 《whatruns》一键分析网站技术栈</a></li><li><a href="https://www.v2fy.com/p/010_speedtest/" target="_blank" rel="noopener">010《speedtest》网络测速插件speedtest</a></li><li><a href="https://www.v2fy.com/p/009_vimium/" target="_blank" rel="noopener">009《vimium》Chrome与vim双神器融合</a></li><li><a href="https://www.v2fy.com/p/008_chrome_cleaner_pro/" target="_blank" rel="noopener">008《Chrome Cleaner Pro》为Chrome加速</a></li><li><a href="https://www.v2fy.com/p/007_loom/" target="_blank" rel="noopener">007《loom》 Chrome翻录网页视频神器</a></li><li><a href="https://www.v2fy.com/p/006_similarsites/" target="_blank" rel="noopener">006《SimilarSites》 一键查找姊妹网站 SimilarSites</a></li><li><a href="https://www.v2fy.com/p/005_video_speed_controller/" target="_blank" rel="noopener">005《Video Speed Controller》 刷课（刷剧）神器！给网页视频加个速(最快可达16倍!)</a></li><li><a href="https://www.v2fy.com/p/004_tampermonkey/" target="_blank" rel="noopener">004《Tampermonkey》 油猴子! 给浏览器开个挂</a></li><li><a href="https://www.v2fy.com/p/003_secure_shell_app/" target="_blank" rel="noopener">003《Secure Shell App》 Chrome中开启ssh一种什么体验</a></li><li><a href="https://www.v2fy.com/p/002_chrono/" target="_blank" rel="noopener">002《chrono》 让Chrome下载资源更容易</a></li><li><a href="https://www.v2fy.com/p/001_markdown_here/" target="_blank" rel="noopener">001《markdown-here》 Markdown一键转换到”富文本格式”</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;完全引用&lt;/code&gt;：&lt;a href=&quot;https://zhaoolee.com/ChromeAppHeroes/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://zhaoolee.com/ChromeAppHeroes/&lt;/a
      
    
    </summary>
    
      <category term="Chrome插件" scheme="/categories/Chrome%E6%8F%92%E4%BB%B6/"/>
    
    
      <category term="Chrome插件" scheme="/tags/Chrome%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Hexo - Next 主题添加评论功能</title>
    <link href="/2019/11/05/Hexo-Next-%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/"/>
    <id>/2019/11/05/Hexo-Next-主题添加评论功能/</id>
    <published>2019-11-05T03:07:09.000Z</published>
    <updated>2019-11-05T03:59:46.659Z</updated>
    
    <content type="html"><![CDATA[<p>Hexo 的 Next 主题继承了多种评论系统，我在这里介绍两种个人觉得不错的评论系统：<code>Valine</code> 和 <code>gitment</code></p><h2 id="Valine-评论系统"><a href="#Valine-评论系统" class="headerlink" title="Valine 评论系统"></a>Valine 评论系统</h2><p><code>本博客使用的评论系统</code></p><p>参考：<a href="https://postgres.fun/20190107095300.html" target="_blank" rel="noopener">Hexo: 添加Valine评论(邮件通知、评论列表头像)</a></p><p>​        <a href="https://valine.js.org/" target="_blank" rel="noopener">Valine - 一款快速、简洁且高效的无后端评论系统</a></p><p>使用 Valine 评论系统，这款系统不需要登录便可以登录，没有后端，Next 主题最新已经支持安装</p><ul><li>基于 Leancloud 的系统</li><li>支持 MarkDown 语法</li><li>无后端实现，快速高效</li></ul><h3 id="注册-LeanCloud"><a href="#注册-LeanCloud" class="headerlink" title="注册 LeanCloud"></a>注册 LeanCloud</h3><p>因为 Valine 是基于 LeanCloud 系统的，所以先在 LeanCloud 中注册账号</p><p><a href="https://leancloud.cn/dashboard/login.html#/signin" target="_blank" rel="noopener">LeanCloud官网登录入口</a></p><p>注册登陆后，访问控制台，创建应用（需要实名验证），选择开发版，创建好之后就生成了 <code>App ID</code> 和 <code>App Key</code></p><h3 id="设置-Next-主题"><a href="#设置-Next-主题" class="headerlink" title="设置 Next 主题"></a>设置 Next 主题</h3><p>在主题的配置文件中，修改关于 valine 的配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Valine.</span></span><br><span class="line"><span class="comment"># You can get your appid and appkey from https://leancloud.cn</span></span><br><span class="line"><span class="comment"># more info please open https://valine.js.org</span></span><br><span class="line">valine:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span> <span class="comment"># 是否开启</span></span><br><span class="line">  appid:   <span class="comment"># 上一步获取的 App ID</span></span><br><span class="line">  appkey:  <span class="comment"># 上一步获取的 App Key</span></span><br><span class="line">  notify: <span class="literal">false</span> <span class="comment"># 新留言是否需要通知 https://github.com/xCss/Valine/wiki</span></span><br><span class="line">  verify: <span class="literal">false</span> <span class="comment"># 是否需要验证，验证比较反人类建议false关闭</span></span><br><span class="line">  placeholder: 请在此输入您的留言 <span class="comment"># 默认留言框内的文字</span></span><br><span class="line">  avatar: monsterid <span class="comment"># 默认头像</span></span><br><span class="line">  guest_info: nick,mail <span class="comment"># 默认留言框的头部需要访问者输入的信息</span></span><br><span class="line">  pageSize: 10 <span class="comment">#默认单页的留言条数</span></span><br></pre></td></tr></table></figure><p><code>avatar</code>可选默认头像：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/valine001.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="评论管理"><a href="#评论管理" class="headerlink" title="评论管理"></a>评论管理</h3><p>如果想要管理评论，进入 leancloud 官网，找到 <code>控制台</code>-&gt;<code>存储</code>-&gt;<code>commet</code> 中进行管理</p><h2 id="Gitment-评论系统"><a href="#Gitment-评论系统" class="headerlink" title="Gitment 评论系统"></a>Gitment 评论系统</h2><p>gitment，它是基于 github 开发的，是依靠于 <code>GitHub Issues</code> 的评论系统，Next 主题最新已经支持安装</p><p>前提：更新 Next 主题（5.1.2 主题）</p><h3 id="注册OAuth-application"><a href="#注册OAuth-application" class="headerlink" title="注册OAuth application"></a>注册OAuth application</h3><ol><li><p>在 github 中进行注册，进入 <a href="https://github.com/settings/profile" target="_blank" rel="noopener">https://github.com/settings/profile</a></p></li><li><p>点击左侧 Developer settings</p></li><li><p>Register a new application</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Application name:<span class="comment">#应用名称</span></span><br><span class="line">Homepage URL：  <span class="comment">#网站URL(填自己的博客主页地址)</span></span><br><span class="line">Application description<span class="comment">#描述</span></span><br><span class="line">Authorization callback URL:<span class="comment">#网站URL(填自己的博客主页地址)</span></span><br></pre></td></tr></table></figure></li><li><p>注册完成之后，会得到：<code>Client ID</code> 和 <code>Client Secret</code></p></li></ol><h3 id="新建存放博客评论仓库"><a href="#新建存放博客评论仓库" class="headerlink" title="新建存放博客评论仓库"></a>新建存放博客评论仓库</h3><p>可以在 github 中建一个项目，专门用来存储你的博客评论</p><h3 id="配置-next-主题文件"><a href="#配置-next-主题文件" class="headerlink" title="配置 next 主题文件"></a>配置 next 主题文件</h3><p>编辑主题配置文件：themes\next\ _config.yml，找到有关 gitment 的设置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gitment:   </span><br><span class="line">  <span class="built_in">enable</span>:  <span class="literal">true</span></span><br><span class="line">  mint: <span class="literal">true</span>  </span><br><span class="line">  count: <span class="literal">true</span> </span><br><span class="line">  lazy: <span class="literal">false</span>  <span class="comment">#评论懒加载，如果true，则默认不展示评论，点击按钮查看评论</span></span><br><span class="line">  cleanly: <span class="literal">false</span>  </span><br><span class="line">  language: </span><br><span class="line">  github_user: <span class="comment">#github名称</span></span><br><span class="line">  github_repo: BlogComments<span class="comment">#上一步新建存放评论的仓库名</span></span><br><span class="line">  client_id: b8bad0exxxx<span class="comment">#上面注册 OAuth Application 的 Client ID</span></span><br><span class="line">  client_secret: bcee560xxxxxx<span class="comment">#上面注册 OAuth Application 申请的 Client Secret</span></span><br><span class="line">  proxy_gateway: </span><br><span class="line">  redirect_protocol: <span class="comment"># Protocol of redirect_uri with force_redirect_protocol when mint</span></span><br></pre></td></tr></table></figure><p>初始化</p><p>在设置完成之后，hexo 重新部署</p><p>每篇文章都要点击初始化评论按钮</p><h3 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h3><p>评论显示在新建存放评论的仓库中的 <code>issue</code> 中</p><h3 id="关闭某个页面的评论"><a href="#关闭某个页面的评论" class="headerlink" title="关闭某个页面的评论"></a>关闭某个页面的评论</h3><p>在页面的 <code>Front-matter</code> 中添加 <code>comments</code> 字段，设为 <code>false</code></p><p>比如标签页不想要评论，则在标签页面中做以下设置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: 标签</span><br><span class="line">date: 2015-12-16 17:05:24</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"tags"</span></span><br><span class="line">comments: <span class="literal">false</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Hexo 的 Next 主题继承了多种评论系统，我在这里介绍两种个人觉得不错的评论系统：&lt;code&gt;Valine&lt;/code&gt; 和 &lt;code&gt;gitment&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;Valine-评论系统&quot;&gt;&lt;a href=&quot;#Valine-评论系统&quot; cl
      
    
    </summary>
    
      <category term="Hexo" scheme="/categories/Hexo/"/>
    
    
      <category term="评论" scheme="/tags/%E8%AF%84%E8%AE%BA/"/>
    
      <category term="Valine" scheme="/tags/Valine/"/>
    
      <category term="gitment" scheme="/tags/gitment/"/>
    
  </entry>
  
  <entry>
    <title>Hexo 个人博客部署到 CentOS 个人服务器</title>
    <link href="/2019/10/30/Hexo-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%88%B0-CentOS-%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>/2019/10/30/Hexo-个人博客部署到-CentOS-个人服务器/</id>
    <published>2019-10-30T09:37:20.000Z</published>
    <updated>2019-10-30T10:36:53.214Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul><li>在一台 CentOS 7.2 的 ECS 云服务器上快速部署基于 Hexo 的博客站点</li><li>可以在本地简洁快速发布一篇博文到个人云服务器上, 用于个人站点展示</li></ul><h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2><blockquote><p>默认 ROOT 权限登录</p></blockquote><h3 id="nginx-安装配置"><a href="#nginx-安装配置" class="headerlink" title="nginx 安装配置"></a>nginx 安装配置</h3><ul><li><p>安装<code>nginx</code></p><p>参考<code>Nan&#39;s Blog</code>的《搭建http服务器-nginx》文章 - （只需要<code>安装启动</code>即可，其它的配置可不管）。</p></li><li><p><code>nginx</code> 配置<code>（可选）</code></p><p><strong>注：如果这一步配置完，访问服务器 <code>IP 或者域名</code>显示不出来想要的效果，就不必执行这一步了（使用默认的<code>/usr/share/nginx/html</code>即可，注意配置Git时对应的路径改成<code>/usr/share/nginx/html</code>即可）</strong></p><p>创建文件目录, 用于博客站点文件存放, 并更改目录读写权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/www/hexo</span><br><span class="line"></span><br><span class="line">chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /data/www/hexo</span><br><span class="line"></span><br><span class="line">chmod -R 755 /data/www/hexo</span><br></pre></td></tr></table></figure><p>添加 <code>index.html</code> 用于检测配置 nginx 是否成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /data/www/hexo/index.html</span><br></pre></td></tr></table></figure><p>添加如下代码:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Nginx running<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置 nginx 服务器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim 查找: /listen 80</span></span><br></pre></td></tr></table></figure><p>通过 vim 查找功能找到如下代码, 并修改</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">server &#123;</span><br><span class="line">      listen       80 default_server;</span><br><span class="line">      listen       [::]:80 default_server;</span><br><span class="line">      server_name  www.xxx.com; <span class="comment"># 填写个人域名（没有就不动）</span></span><br><span class="line">      root         /data/www/hexo;</span><br><span class="line">  &#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>访问服务器 <code>IP 或者域名</code>显示</p><blockquote><p>Nginx running</p></blockquote><p>nginx 配置成功</p></li></ul><h3 id="Git-安装配置"><a href="#Git-安装配置" class="headerlink" title="Git 安装配置"></a>Git 安装配置</h3><ul><li><p>安装<code>Git</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure></li><li><p><code>Git</code>配置</p><p>创建文件目录, 用于私人 Git 仓库搭建, 并更改目录读写权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/GitLibrary</span><br><span class="line"></span><br><span class="line">chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /data/GitLibrary</span><br><span class="line"></span><br><span class="line">chmod -R 755 /data/GitLibrary</span><br></pre></td></tr></table></figure><ul><li><p>Git 初始化裸库</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/GitLibrary</span><br><span class="line">git init --bare blog.git</span><br></pre></td></tr></table></figure></li><li><p>创建 Git 钩子(hook)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /data/GitLibrary/blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure><p>用于指定 Git 的源代码 和 Git 配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 上面的“nginx配置（可选）”成功使用以下配置：</span></span><br><span class="line">git --work-tree=/data/www/hexo --git-dir=/data/GitLibrary/blog.git checkout -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的“nginx配置（可选）”失败使用以下配置：</span></span><br><span class="line">git --work-tree=/usr/share/nginx/html --git-dir=/data/GitLibrary/blog.git checkout -f</span><br></pre></td></tr></table></figure><p>保存并退出</p></li><li><p>给该文件添加可执行权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /data/GitLibrary/blog.git/hooks/post-receiv</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="本地配置"><a href="#本地配置" class="headerlink" title="本地配置"></a>本地配置</h2><p>参考该篇博客：<a href="https://thief.one/2017/03/03/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">Hexo搭建博客教程</a></p><p>参考意思博客配置完后只需要再修改下<code>_config.yml</code>文件，具体如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/hexo001.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#repo: 用户名@域名或 IP 地址:/data/GitLibrary/blog</span></span><br></pre></td></tr></table></figure><h2 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h2><p>将本地部署到服务器</p><ul><li><p>清除缓存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure></li><li><p>生成静态页面:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line"><span class="comment"># 即：hexo generate</span></span><br></pre></td></tr></table></figure></li><li><p>将本地静态页面目录部署到云服务器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br><span class="line"><span class="comment"># 即：hexo deploy</span></span><br></pre></td></tr></table></figure><p>这一步会让你输入服务器密码<code>（每次）</code>：</p><p><img src="/img/hexo002.png" alt=""></p><p>完成 <code>Hexo</code> 个人博客网站搭建, 通过服务器 <code>IP</code> 或者<code>域名</code>即可访问</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;在一台 CentOS 7.2 的 ECS 云服务器上快速部署基于 Hexo 的博客站点&lt;/li&gt;
&lt;li&gt;可以在本地简洁快速发布
      
    
    </summary>
    
      <category term="hexo" scheme="/categories/hexo/"/>
    
    
      <category term="博客" scheme="/tags/%E5%8D%9A%E5%AE%A2/"/>
    
      <category term="CentOS" scheme="/tags/CentOS/"/>
    
  </entry>
  
  <entry>
    <title>软件需求，概要设计，详细设计（文档）怎么做，做什么？</title>
    <link href="/2019/10/16/%E8%BD%AF%E4%BB%B6%E9%9C%80%E6%B1%82%EF%BC%8C%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1%EF%BC%8C%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%EF%BC%88%E6%96%87%E6%A1%A3%EF%BC%89%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%8C%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
    <id>/2019/10/16/软件需求，概要设计，详细设计（文档）怎么做，做什么？/</id>
    <published>2019-10-16T03:25:39.000Z</published>
    <updated>2019-10-16T03:33:09.027Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于项目工作需要 ，需要提供《软件需求规格说明书》，《软件概要设计说明书》和《软件详细设计说明书》。所以这里整理学习一下相关文档需要的内容。文章并不设计对所有需求分析，概要设计和详细设计的详细描述。因为这其中的任何一点都可以单独提取出来成为软件工程学科中的一本书籍内容。</p><h2 id="软件设计的整体流程："><a href="#软件设计的整体流程：" class="headerlink" title="软件设计的整体流程："></a>软件设计的整体流程：</h2><ul><li>软件需求分析阶段：输出了《软件需求规格说明书》，不涉及具体实现方法。用户能看得明白，开发人员也可据此进行下面的工作，<code>搞清楚“要解决什么问题”</code></li><li>概要设计阶段：确定软件系统的总体布局，各个子模块的功能和模块间的关系，与外部系统的关系，选择的技术路线。有一些研究与论证性的内容。并输出《软件概要设计说明书》。<code>搞清楚“总体实现方案”</code></li><li>详细设计阶段：对概要设计的进一步细化，一般由各部分的担当人员依据概要设计分别完成，然后在集成，是具体的实现细节。是“程序”的蓝图，确定每个模块采用的算法、数据结构、接口的实现、属性、参数。并输出《软件详细设计说明书》。<code>搞清楚“每个模块怎么做”</code></li></ul><h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="我们为什么需要《软件需求规格说明书》-？"><a href="#我们为什么需要《软件需求规格说明书》-？" class="headerlink" title="我们为什么需要《软件需求规格说明书》 ？"></a>我们为什么需要《软件需求规格说明书》 ？</h3><p>如果需求的编写只是为了解释说明软件实现的功能，那么良好的编码结构，代码注释就可以很好的实现软件的功能说明，程序员可以将编写需求的时间节约下来进行更多功能的实现； 可是，这样的情况可能更多适用于中小型项目，或者互联网项目，因为这样的项目需求不复杂，并且需求变化很快，所以研发的效率非常重要。然而，针对大型软件项目或者功能比较复杂的系统，软件研发可能是多人协作的成果，所以在信息传递过程中， 我们只有提前考虑好软件需求的内容，才能正确评估开发软件所需要的时间，成本的要素，从而更好的管理项目。</p><h3 id="《软件需求规格说明书》的一般结构"><a href="#《软件需求规格说明书》的一般结构" class="headerlink" title="《软件需求规格说明书》的一般结构"></a>《软件需求规格说明书》的一般结构</h3><ul><li>正文的第一章内容是1.概述，包含<br>1.1.编写目的；1.2.术语与定义；1.3.参考资料；三个部分</li><li>第二章要给出该项目的标准和规范，在文档的后续内容编写中以及项目开发过程中必须遵照这个标准和规范进行。</li><li>第三章应该说明该项目的相关假设、限制和一些依赖条件，在后续系统部署的过程中可以有参考意义。</li><li>第四章“功能规格”是重点，重点介绍这个系统的角色，界面设计思路，系统的功能视图和功能点清单，以及系统的需求用例。这个内容必须详细描述，这样才能对后续的开发和测试提供指导意义。</li><li>第五章“非功能规格”要对项目的性能、安全、数据的备份恢复等内容解释解释说明，一个项目除了功能完整之外，还要考虑性能、安全等相应的要求。</li><li>第六章“附录”，是对软件需求规格说明书的一些补充说明文档，其中的“软件需求跟踪矩阵”是重点，这份文档是对后续需求的完善程度进行了严格的控制。</li></ul><h2 id="概要设计"><a href="#概要设计" class="headerlink" title="概要设计"></a>概要设计</h2><h3 id="《概要设计说明书》的一般结构"><a href="#《概要设计说明书》的一般结构" class="headerlink" title="《概要设计说明书》的一般结构"></a>《概要设计说明书》的一般结构</h3><ul><li>总述：需求或目标（讲一下事情的起源）、环境、局限；</li><li>总体设计：从全局的角度说一下 组织结构、功能、处理流程、有哪些模块、模块间的关系，运行环境等。（输出图：系统结构图，系统流程图，数据流程图，推荐在线画图工具<a href="https://www.processon.com/" target="_blank" rel="noopener">https://www.processon.com/</a>）</li><li>外部接口：总体说明外部用户、软、硬件接口(可用资源)；</li><li>模块设计：每个模块“做什么”、简要说明“怎么做”（输入、输出、处理逻辑、与其它模块或系统的接口），处在什么逻辑位置、物理位置。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">模块设计,可以写以下内容：</span><br><span class="line">   1、模块描述：说明哪些模块实现了哪些功能；</span><br><span class="line">   2、模块层次结构：可以使用某个视角的软件框架图来表达；</span><br><span class="line">   3、模块间的关系：模块间依赖关系的描述，通信机制描述；</span><br><span class="line">   4、模块的核心接口：说明模块传递的信息、信息的结构；</span><br><span class="line">   5、处理方式设计：说一些满足功能和性能的算法；</span><br></pre></td></tr></table></figure><ul><li>数据结构：逻辑结构、物理结构。</li><li>容灾设计：出错信息、出错处理。（可选）</li><li>监控设计：运行模块组合、控制、时间。（可选）</li><li>用户界面设计：（可选）。</li><li>安全设计：（可选）。</li><li>其它设计：（可选）。</li><li>制定规范（附录）： 设计原则,代码规范、接口规约、命名规则。</li></ul><h3 id="概要设计需要注意的地方"><a href="#概要设计需要注意的地方" class="headerlink" title="概要设计需要注意的地方"></a>概要设计需要注意的地方</h3><ul><li>用来评价总体设计的可行性。</li><li>用来检查设计的模块是否完整，保证每一个功能都有对应的模块来实现。</li><li>用来评估开发工作量、指导开发计划（在不写详细设计的情况下）。</li><li>概要设计阶段过于重视业务流程是个误区。</li><li>概要设计阶段过于重视细节实现是个误区。</li></ul><h2 id="详细设计"><a href="#详细设计" class="headerlink" title="详细设计"></a>详细设计</h2><h3 id="《详细设计说明书》的一般结构"><a href="#《详细设计说明书》的一般结构" class="headerlink" title="《详细设计说明书》的一般结构"></a>《详细设计说明书》的一般结构</h3><p>参考<a href="https://blog.csdn.net/xiaxia_1006/article/details/52330202" target="_blank" rel="noopener">如何撰写软件详细设计内容？</a></p><ul><li>引言，包含：<br>编写目的，背景，参考资料，术语定义及说明</li><li>设计概述，包含：任务和目标，需求概述，运行环境概述， 条件与限制，详细设计方法和工具</li><li>系统详细需求分析，包含：详细需求分析，详细系统运行环境及限制条件分析接口需求分析</li><li>总体方案确认，包含： 系统总体结构确认， 系统详细界面划分</li><li>系统详细设计，包含： 系统结构设计及子系统划分，系统功能模块详细设计（采用HIPO图进行功能分解与模块描述，，用IPO或结构图描述各模块的组成结构、算法、模块间的接口关系，以及需求、功能和模块三者之间的交叉参照关系。）, 系统界面详细设计</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">每个模块的描述说明可参照以下格式：</span><br><span class="line"></span><br><span class="line">**模块编号：**</span><br><span class="line"></span><br><span class="line">**模块名称：**</span><br><span class="line"></span><br><span class="line">**输入：**</span><br><span class="line"></span><br><span class="line">**处理：**</span><br><span class="line"></span><br><span class="line">**算法描述：**</span><br><span class="line"></span><br><span class="line">**输出：**</span><br></pre></td></tr></table></figure><ul><li>数据库系统设计</li></ul><h3 id="详细设计需要注意的地方"><a href="#详细设计需要注意的地方" class="headerlink" title="详细设计需要注意的地方"></a>详细设计需要注意的地方</h3><p>如果有或者有必要，特别是大型的软件系统，详细设计阶段划分系统功能模块或子系统。</p><h2 id="概要设计和详细设计的区别"><a href="#概要设计和详细设计的区别" class="headerlink" title="概要设计和详细设计的区别"></a>概要设计和详细设计的区别</h2><h3 id="概要设计阶段"><a href="#概要设计阶段" class="headerlink" title="概要设计阶段"></a>概要设计阶段</h3><p>在这个阶段，设计者会大致考虑并照顾模块的内部实现，但不过多纠缠于此。主要集中于划分模块、分配任务、定义调用关系。模块间的接口与传参在这个阶段要定得十分细致明确，应编写严谨的数据字典，避免后续设计产生不解或误解。概要设计一般不是一次就能做到位，而是反复地进行结构调整。典型的调整是合并功能重复的模块，或者进一步分解出可以复用的模块。在概要设计阶段，应最大限度地提取可以重用的模块，建立合理的结构体系，节省后续环节的工作量。<br>概要设计文档最重要的部分是分层数据流图、结构图、数据字典以及相应的文字说明等。以概要设计文档为依据，各个模块的详细设计就可以并行展开了。</p><h3 id="详细设计阶段"><a href="#详细设计阶段" class="headerlink" title="详细设计阶段"></a>详细设计阶段</h3><p>在这个阶段，各个模块可以分给不同的人去并行设计。在详细设计阶段，设计者的工作对象是一个模块，根据概要设计赋予的局部任务和对外接口，设计并表达出模块的算法、流程、状态转换等内容。这里要注意，如果发现有结构调整（如分解出子模块等）的必要，必须返回到概要设计阶段，将调整反应到概要设计文档中，而不能就地解决，不打招呼。<br>详细设计文档最重要的部分是模块的流程图、状态图、局部变量及相应的文字说明等。</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://jingyan.baidu.com/article/4ae03de3d7bdc43eff9e6b19.html" target="_blank" rel="noopener">软件需求规格说明书模板</a><br><a href="https://www.cnblogs.com/bmaker/p/6116177.html" target="_blank" rel="noopener">软件概要设计-模板</a><br><a href="http://elf8848.iteye.com/blog/1582323" target="_blank" rel="noopener">软件概要设计做什么，怎么做</a><br><a href="http://elf8848.iteye.com/blog/2165655" target="_blank" rel="noopener">互联网公司研发RD如何撰写总体设计与详细设计文档</a><br><a href="https://bbs.csdn.net/topics/330012397" target="_blank" rel="noopener">项目开发过程中详细设计和概要设计有什么区别和要求?</a><br><a href="https://blog.csdn.net/xiaxia_1006/article/details/52330202" target="_blank" rel="noopener">如何撰写软件详细设计内容？</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;由于项目工作需要 ，需要提供《软件需求规格说明书》，《软件概要设计说明书》和《软件详细设计说明书》。所以这里整理学习一下相关文档需要的内容。
      
    
    </summary>
    
      <category term="文档" scheme="/categories/%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="软件需求" scheme="/tags/%E8%BD%AF%E4%BB%B6%E9%9C%80%E6%B1%82/"/>
    
      <category term="概要设计" scheme="/tags/%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="详细设计" scheme="/tags/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Rainloop安装配置</title>
    <link href="/2019/09/27/Rainloop%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <id>/2019/09/27/Rainloop安装配置/</id>
    <published>2019-09-27T01:57:53.000Z</published>
    <updated>2019-09-27T02:11:46.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>RainLoop</code>是一个基于<code>WEB</code>的邮件系统，使用<code>PHP</code>开发，通过<code>RainLoop</code>可以将多个邮箱聚合在一起，程序拥有简介的界面和全面的功能，支持<code>SMTP</code>+<code>IMAP</code>，是个人邮件客户端的最佳程序。这里说下安装方法。</p><h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p><code>RainLoop</code>要想运行起来需要满足该博客<code>“PHP入门技巧”</code>完成的PHP环境。</p><h2 id="Rainloop安装"><a href="#Rainloop安装" class="headerlink" title="Rainloop安装"></a>Rainloop安装</h2><ol><li>Rainloop官网<ul><li>官方网站：<a href="https://www.rainloop.net" target="_blank" rel="noopener">https://www.rainloop.net</a></li><li>下载地址：<a href="https://www.rainloop.net/downloads" target="_blank" rel="noopener">https://www.rainloop.net/downloads</a></li></ul></li><li>将Rainloop安装包下载后解压上传到你的网站服务器上（<code>/www</code>目录下），然后直接用浏览器访问：<a href="http://wampserver-test.com/?admin，输入以下登录信息登录：" target="_blank" rel="noopener">http://wampserver-test.com/?admin，输入以下登录信息登录：</a><ul><li>用户名：<code>admin</code></li><li>密码：<code>12345</code></li></ul></li></ol><h2 id="RainLoop设置方法"><a href="#RainLoop设置方法" class="headerlink" title="RainLoop设置方法"></a>RainLoop设置方法</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/rainloop001.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>这么些设置，自己摸索，就不多说了</p><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p><code>RainLoop</code>用<code>PHP</code>开发，正常情况下在<code>PHP</code>环境中就可以运行，有时候并不需要数据库，应用程序不存储电子邮件，应用直接访问邮件服务器和<code>RainLoop</code>显示邮件而已，简单实用！性能方面完全取决于你的服务器内存和网速了，如果您需要启用邮件联系人，则需要用数据库（<code>MySQL</code>），具体可以自行折腾。当然我们自己使用的话，完全没有问题。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;code&gt;RainLoop&lt;/code&gt;是一个基于&lt;code&gt;WEB&lt;/code&gt;的邮件系统，使用&lt;code&gt;PHP&lt;/code&gt;开发，通
      
    
    </summary>
    
      <category term="Rainloop" scheme="/categories/Rainloop/"/>
    
    
      <category term="安装配置" scheme="/tags/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    
      <category term="WebMail" scheme="/tags/WebMail/"/>
    
  </entry>
  
  <entry>
    <title>PHP入门技巧</title>
    <link href="/2019/09/24/PHP%E5%85%A5%E9%97%A8%E6%8A%80%E5%B7%A7/"/>
    <id>/2019/09/24/PHP入门技巧/</id>
    <published>2019-09-24T02:01:34.000Z</published>
    <updated>2019-09-24T03:37:39.305Z</updated>
    
    <content type="html"><![CDATA[<h2 id="集成环境"><a href="#集成环境" class="headerlink" title="集成环境"></a>集成环境</h2><h3 id="wamperserver"><a href="#wamperserver" class="headerlink" title="wamperserver"></a>wamperserver</h3><ol><li><p>下载好安装到本地指定目录，官网下载地址  <a href="http://www.wampserver.com" target="_blank" rel="noopener">http://www.wampserver.com</a></p><p><strong>安装成功的标志：</strong></p><ol><li><p>双击运行<code>wamperserver</code>图标后：</p><p><img src="/img/php003.png" alt=""></p></li><li><p>浏览器访问<code>localhost</code>出现以下页面表示安装成功</p><p><img src="/img/php004.png" alt=""></p></li></ol></li><li><p>根据自己实际的安装路径，<code>D:\maliangnansheng\wamp64\bin\apache\apache2.4.39\conf</code>，找到 apache  的配置文件 <code>httpd.conf</code></p><p><img src="/img/php001.png" alt=""></p><p>也可以<code>左键</code>图标直接打开文件修改：</p><p><img src="/img/php002.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">打开文件httpd.conf文件</span><br><span class="line">搜索Include conf/extra/httpd-vhosts.conf</span><br><span class="line">去掉它前面的#，然后保存这个文件</span><br></pre></td></tr></table></figure></li><li><p>打开<code>D:\maliangnansheng\wamp64\bin\apache\apache2.4.39\conf\extra\httpd-vhosts.conf</code>文件，添加域名映射项，一般是在文件的最后添加上：</p><p><img src="/img/php005.png" alt=""></p><p>也可以<code>左键</code>图标直接打开文件修改：</p><p><img src="/img/php006.png" alt=""></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加的内容：</span></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">  ServerName wampserver-test.com</span><br><span class="line">  ServerAlias wampserver-test.com</span><br><span class="line">  DocumentRoot <span class="string">"<span class="variable">$&#123;INSTALL_DIR&#125;</span>/www"</span></span><br><span class="line">  &lt;Directory <span class="string">"<span class="variable">$&#123;INSTALL_DIR&#125;</span>/www/"</span>&gt;</span><br><span class="line">    Options +Indexes +Includes +FollowSymLinks +MultiViews</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require <span class="built_in">local</span></span><br><span class="line">  &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ServerName wampserver-test.com为配置的虚拟站点</span></span><br><span class="line"><span class="comment"># DocumentRoot "$&#123;INSTALL_DIR&#125;/www"项目文件的路径</span></span><br></pre></td></tr></table></figure><p>视图如下：</p><p><img src="/img/php007.png" alt=""></p></li><li><p>找到本机的 host  文件（<code>C:\Windows\System32\drivers\etc</code> ），绑定到本地</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在文件最后添加域名：</span></span><br><span class="line">127.0.0.1 wampserver-test.com</span><br></pre></td></tr></table></figure></li><li><p>重启服务环境，就可以通过域名访问项目了</p><p><img src="/img/php008.png" alt=""></p></li></ol><h3 id="phpStudy"><a href="#phpStudy" class="headerlink" title="phpStudy"></a>phpStudy</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/img/php009.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="php7-2-废弃each方法"><a href="#php7-2-废弃each方法" class="headerlink" title="php7.2 废弃each方法"></a>php7.2 废弃each方法</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$b = <span class="keyword">array</span>();</span><br><span class="line">each($b);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Deprecated:  The each() function is deprecated. This message will be suppressed on further calls</span></span><br></pre></td></tr></table></figure><p>each方法<code>替换</code>为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun_adm_each</span><span class="params">(&amp;$array)</span></span>&#123;</span><br><span class="line">   $res = <span class="keyword">array</span>();</span><br><span class="line">   $key = key($array);</span><br><span class="line">   <span class="keyword">if</span>($key !== <span class="keyword">null</span>)&#123;</span><br><span class="line">       next($array); </span><br><span class="line">       $res[<span class="number">1</span>] = $res[<span class="string">'value'</span>] = $array[$key];</span><br><span class="line">       $res[<span class="number">0</span>] = $res[<span class="string">'key'</span>] = $key;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       $res = <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;集成环境&quot;&gt;&lt;a href=&quot;#集成环境&quot; class=&quot;headerlink&quot; title=&quot;集成环境&quot;&gt;&lt;/a&gt;集成环境&lt;/h2&gt;&lt;h3 id=&quot;wamperserver&quot;&gt;&lt;a href=&quot;#wamperserver&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
      <category term="PHP" scheme="/categories/PHP/"/>
    
    
      <category term="技巧" scheme="/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="集成环境" scheme="/tags/%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83/"/>
    
  </entry>
  
  <entry>
    <title>EwoMail邮件服务器搭建and配置</title>
    <link href="/2019/09/19/EwoMail%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAand%E9%85%8D%E7%BD%AE/"/>
    <id>/2019/09/19/EwoMail邮件服务器搭建and配置/</id>
    <published>2019-09-19T08:24:34.000Z</published>
    <updated>2019-09-19T08:58:30.371Z</updated>
    
    <content type="html"><![CDATA[<p><strong>引用：</strong></p><ul><li><a href="http://doc.ewomail.com/docs/ewomail/install" target="_blank" rel="noopener">EwoMail 邮件服务器（开源版文档）</a></li><li><a href="https://www.laozuo.org/12465.html" target="_blank" rel="noopener">利用EwoMail开源软件自建邮件服务器 - 安装设置篇</a></li></ul><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>以下是无错的简单安装流程，如安装过程出错请参见《引用》地址</p><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>安装前请检查端口，点击查看（<a href="http://doc.ewomail.com/docs/ewomail/not_server" target="_blank" rel="noopener">无法连接服务器</a>）</p><p>centos6/7系统，服务器需要干净环境，要求全新干净系统，不能安装在已有的apache,mysql的环境中。</p><p>最低配置要求<br>CPU：1核<br>内存：1G<br>硬盘：40G</p><p>由于新版本的杀毒软件占用的内存比较多，512M到2GB内存请参考<a href="http://doc.ewomail.com/docs/ewomail/reduce_memory" target="_blank" rel="noopener">降低内存占用</a></p><p>EwoMail安装后会把数据存放在 <code>/ewomail</code> 目录<br>建议你提前创建 <code>/ewomail</code> 目录，并且将硬盘容量挂载或分配到<code>/ewomail</code></p><h2 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/selinux</span><br><span class="line"></span><br><span class="line"><span class="comment"># SELINUX=enforcing 改为 SELINUX=disabled</span></span><br></pre></td></tr></table></figure><h2 id="检查swap"><a href="#检查swap" class="headerlink" title="检查swap"></a>检查swap</h2><p>如果没启动swap，这会导致EwoMail的防病毒组件不能启动，所以在安装前先检查swap是否已经启动，如已启动可跳过该步骤。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看swap</span></span><br><span class="line">free -m</span><br></pre></td></tr></table></figure><p>如果swap位置<code>都显示是0</code>，那么系统还没创建swap</p><h3 id="创建swap分区（内存超过2G，可不配置）"><a href="#创建swap分区（内存超过2G，可不配置）" class="headerlink" title="创建swap分区（内存超过2G，可不配置）"></a>创建swap分区<code>（内存超过2G，可不配置）</code></h3><p>创建1G的swap，可以根据你的服务器配置来调整大小</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/mnt/swap bs=1M count=1024</span><br></pre></td></tr></table></figure><p>设置交换分区文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /mnt/swap</span><br></pre></td></tr></table></figure><p>启动swap</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon /mnt/swap</span><br></pre></td></tr></table></figure><p>设置开机时自启用 swap 分区</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要修改文件 /etc/fstab 中的 swap 行，在最后-添加以下内容</span></span><br><span class="line">/mnt/swap swap swap defaults 0 0</span><br></pre></td></tr></table></figure><h2 id="邮箱域名"><a href="#邮箱域名" class="headerlink" title="邮箱域名"></a>邮箱域名</h2><p>EwoMail本身是可以配置<code>多个域名</code>来收发邮件的，但在安装前需要<code>一个邮箱的主域名</code>。<br>本次教程例子使用的主域名是sunsheen.cn</p><h2 id="设置主机名（可不配置主机名）"><a href="#设置主机名（可不配置主机名）" class="headerlink" title="设置主机名（可不配置主机名）"></a>设置主机名<code>（可不配置主机名）</code></h2><p>EwoMail在安装后会默认使用域名前缀mail的主机名，例如mail.sunsheen.cn<br>将系统主机名改成mail.sunsheen.cn</p><p>查看当前主机名</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname -f</span><br></pre></td></tr></table></figure><p>输入命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl <span class="built_in">set</span>-hostname mail.sunsheen.cn</span><br></pre></td></tr></table></figure><p>修改文件 <code>/etc/hosts</code> , 添加 <code>mail.sunsheen.cn</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line"><span class="comment"># 在文件最后添加一下内容：</span></span><br><span class="line">172.18.11.11 mail.sunsheen.cn mail localhost</span><br></pre></td></tr></table></figure><h2 id="安装EwoMail邮件软件"><a href="#安装EwoMail邮件软件" class="headerlink" title="安装EwoMail邮件软件"></a>安装EwoMail邮件软件</h2><ol><li><p>代码获取渠道</p><blockquote><p>渠道：<a href="http://ewomail.com/list-11.html" target="_blank" rel="noopener">http://ewomail.com/list-11.html</a></p></blockquote><p>输入域名，然后生成安装地址，然后去执行安装</p><p><img src="/img/ewomail001.png" alt=""></p></li><li><p>安装成功</p><p><img src="/img/ewomail002.png" alt=""></p><p>现在就安装成功了，可以访问<code>邮箱管理后台</code>和<code>web邮件系统</code></p></li></ol><h2 id="EwoMail邮件系统登录管理"><a href="#EwoMail邮件系统登录管理" class="headerlink" title="EwoMail邮件系统登录管理"></a>EwoMail邮件系统登录管理</h2><blockquote><p>邮箱管理后台：<a href="http://IP:8010" target="_blank" rel="noopener">http://IP:8010</a> （默认账号admin，密码ewomail123）</p><p>web邮件系统：<a href="http://IP:8000" target="_blank" rel="noopener">http://IP:8000</a></p></blockquote><ul><li><p>web邮件系统-8000</p><p><img src="/img/ewomail003.png" alt=""></p></li><li><p>邮箱管理后台-8010</p><p><img src="/img/ewomail004.png" alt=""></p><p>登录后：</p><p><img src="/img/ewomail005.png" alt=""></p></li></ul><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;引用：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://doc.ewomail.com/docs/ewomail/install&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;EwoMail 邮件服务器（开源版文
      
    
    </summary>
    
      <category term="EwoMail" scheme="/categories/EwoMail/"/>
    
    
      <category term="邮件服务器" scheme="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
      <category term="搭建" scheme="/tags/%E6%90%AD%E5%BB%BA/"/>
    
      <category term="配置" scheme="/tags/%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>Java 远程执行 Linux 的命令</title>
    <link href="/2019/09/05/Java-%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C-Linux-%E7%9A%84%E5%91%BD%E4%BB%A4/"/>
    <id>/2019/09/05/Java-远程执行-Linux-的命令/</id>
    <published>2019-09-05T03:30:30.000Z</published>
    <updated>2019-09-10T02:25:14.916Z</updated>
    
    <content type="html"><![CDATA[<p>在 Java 中可以通过 SSH2 协议远程执行 Linux 系统的命令或 Shell 脚本。</p><h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>需添加 <code>ganymed-ssh2-262.jar</code> 、<code>commons-io-2.6.jar</code>、<code>commons-lang3-3.9.jar</code>、<code>fastjson-1.2.58.jar</code>包，Maven 依赖如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/ch.ethz.ganymed/ganymed-ssh2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.ethz.ganymed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ganymed-ssh2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>262<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.58<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="api-说明"><a href="#api-说明" class="headerlink" title="api 说明"></a>api 说明</h2><ol><li><p>首先构造一个连接器，传入一个需要登陆的ip地址；</p><p><code>Connection conn = new Connection(hostname);</code></p></li><li><p>模拟登陆目的服务器，传入用户名和密码；</p><p><code>boolean isAuthenticated = conn.authenticateWithPassword(username, password);</code></p><p>它会返回一个布尔值，true 代表成功登陆目的服务器，否则登陆失败。</p></li><li><p>打开一个session，执行你需要的linux 脚本命令；</p><p><code>Session session = conn.openSession();</code><br><code>session.execCommand(“ifconfig”);</code></p></li><li><p>接收目标服务器上的控制台返回结果，读取br中的内容；</p><p><code>InputStream stdout = new StreamGobbler(sess.getStdout());</code><br><code>BufferedReader br = new BufferedReader(new InputStreamReader(stdout));</code></p></li><li><p>得到脚本运行成功与否的标志 ：0－成功 非0－失败</p><p><code>System.out.println(“ExitCode: ” + sess.getExitStatus());</code></p></li><li><p>关闭session和connection</p><p><code>sess.close();</code><br><code>conn.close();</code></p></li></ol><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>1、通过第2步认证成功后，当前目录就位于/home/username/目录之下，你可以指定脚本文件所在的绝对路径，或者通过cd导航到脚本文件所在的目录，然后传递执行脚本所需要的参数，完成脚本调用执行。</p><p>2、执行脚本以后，可以获取脚本执行的结果文本，需要对这些文本进行正确编码后返回给客户端，避免乱码产生。</p><p>3、如果你需要执行多个linux控制台脚本，比如第一个脚本的返回结果是第二个脚本的入参，你必须打开多个Session,也就是多次调用<br>Session sess = conn.openSession();,使用完毕记得关闭就可以了。</p><h2 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.Connection;</span><br><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.Session;</span><br><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.StreamGobbler;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 远程执行Linux命令</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 92481</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteExecuteCommand</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 字符编码默认是utf-8</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String DEFAULTCHART = <span class="string">"UTF-8"</span>;</span><br><span class="line">  <span class="keyword">private</span> Connection conn;</span><br><span class="line">  <span class="keyword">private</span> String ip;</span><br><span class="line">  <span class="keyword">private</span> String userName;</span><br><span class="line">  <span class="keyword">private</span> String userPwd;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RemoteExecuteCommand</span><span class="params">(String ip, String userName, String userPwd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ip = ip;</span><br><span class="line">    <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    <span class="keyword">this</span>.userPwd = userPwd;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RemoteExecuteCommand</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 远程登录linux主机</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> 登录成功返回true，否则返回false</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">login</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> flg = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      conn = <span class="keyword">new</span> Connection(ip);</span><br><span class="line">      <span class="comment">// 连接</span></span><br><span class="line">      conn.connect();</span><br><span class="line">      <span class="comment">// 认证</span></span><br><span class="line">      flg = conn.authenticateWithPassword(userName, userPwd);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"远程连接服务器失败"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 远程执行shll脚本或者命令</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> cmd 即将执行的命令</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> 命令执行完后返回的结果值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String result = <span class="string">""</span>;</span><br><span class="line">    Session session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (login()) &#123;</span><br><span class="line">        <span class="comment">// 打开一个会话</span></span><br><span class="line">        session = conn.openSession();</span><br><span class="line">        <span class="comment">// 执行命令</span></span><br><span class="line">        session.execCommand(cmd);</span><br><span class="line">        result = processStdout(session.getStdout(), DEFAULTCHART);</span><br><span class="line">        <span class="comment">// 如果为输出为空，说明脚本执行出错了</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(result)) &#123;</span><br><span class="line">          result = processStdout(session.getStderr(), DEFAULTCHART);</span><br><span class="line">        &#125;</span><br><span class="line">        conn.close();</span><br><span class="line">        session.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"命令执行失败"</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">        conn.close();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">        session.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解析脚本执行返回的结果集</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> in 输入流对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> charset 编码</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> 以纯文本的格式返回</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> String <span class="title">processStdout</span><span class="params">(InputStream in, String charset)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    InputStream stdout = <span class="keyword">new</span> StreamGobbler(in);</span><br><span class="line">    StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    InputStreamReader isr = <span class="keyword">null</span>;</span><br><span class="line">    BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      isr = <span class="keyword">new</span> InputStreamReader(stdout, charset);</span><br><span class="line">      br = <span class="keyword">new</span> BufferedReader(isr);</span><br><span class="line">      String line = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        buffer.append(line + <span class="string">"\n"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"不支持的编码字符集异常"</span>, e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"读取指纹失败"</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      IOUtils.close(br);</span><br><span class="line">      IOUtils.close(isr);</span><br><span class="line">      IOUtils.close(stdout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buffer.toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String linuxIP = <span class="string">"172.18.195.253"</span>;</span><br><span class="line">    String usrName = <span class="string">"root"</span>;</span><br><span class="line">    String passwd  = <span class="string">"Jufeng2010"</span>;</span><br><span class="line">    RemoteExecuteCommand rec = <span class="keyword">new</span> RemoteExecuteCommand(linuxIP, usrName, passwd);</span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    System.out.println(rec.execute(<span class="string">"ip a"</span>));</span><br><span class="line">    <span class="comment">// 执行脚本</span></span><br><span class="line"><span class="comment">// rec.execute("sh /etc/init.d/domain.sh hkc.demo.sunsheen.cn 172.18.195.155 8888");</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行脚本 （域名访问）</span></span><br><span class="line">rec.execute(<span class="string">"sh /etc/init.d/domain.sh "</span> + domainBef+domainLater + <span class="string">" "</span> + ip + <span class="string">" "</span> + </span><br><span class="line">innerPort + <span class="string">" "</span> + createUserName);</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d/domain.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d/</span><br><span class="line"><span class="comment"># 创建配置文件</span></span><br><span class="line">touch <span class="variable">$1_</span><span class="variable">$4</span>.conf;</span><br><span class="line"><span class="comment"># 像配置文件写入内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"server &#123;</span></span><br><span class="line"><span class="string">        listen 80;</span></span><br><span class="line"><span class="string">        server_name <span class="variable">$1</span>;</span></span><br><span class="line"><span class="string">        location / &#123;</span></span><br><span class="line"><span class="string">                proxy_pass http://<span class="variable">$2</span>:<span class="variable">$3</span>;</span></span><br><span class="line"><span class="string">                proxy_set_header Host \$host:80;</span></span><br><span class="line"><span class="string">                proxy_set_header X-Real-IP \$remote_addr;</span></span><br><span class="line"><span class="string">                proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;</span></span><br><span class="line"><span class="string">                proxy_set_header Via \"nginx\";</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">&#125;"</span> &gt; <span class="variable">$1_</span><span class="variable">$4</span>.conf;</span><br><span class="line"><span class="comment"># 重启nginx</span></span><br><span class="line">nginx -s reload;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在 Java 中可以通过 SSH2 协议远程执行 Linux 系统的命令或 Shell 脚本。&lt;/p&gt;
&lt;h2 id=&quot;添加依赖&quot;&gt;&lt;a href=&quot;#添加依赖&quot; class=&quot;headerlink&quot; title=&quot;添加依赖&quot;&gt;&lt;/a&gt;添加依赖&lt;/h2&gt;&lt;p&gt;需添加 &lt;co
      
    
    </summary>
    
      <category term="Java远程Linux命令" scheme="/categories/Java%E8%BF%9C%E7%A8%8BLinux%E5%91%BD%E4%BB%A4/"/>
    
    
      <category term="Linux" scheme="/tags/Linux/"/>
    
      <category term="Java" scheme="/tags/Java/"/>
    
      <category term="远程命令" scheme="/tags/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7.x - 安装MySQL 5.7</title>
    <link href="/2019/08/21/CentOS-7-x-%E5%AE%89%E8%A3%85MySQL-5-7/"/>
    <id>/2019/08/21/CentOS-7-x-安装MySQL-5-7/</id>
    <published>2019-08-21T06:20:39.000Z</published>
    <updated>2019-08-22T02:59:43.440Z</updated>
    
    <content type="html"><![CDATA[<h1 id="在线安装"><a href="#在线安装" class="headerlink" title="在线安装"></a>在线安装</h1><p>引用：<a href="https://juejin.im/post/5c088b066fb9a049d4419985" target="_blank" rel="noopener">他人博客</a>、<a href="https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/" target="_blank" rel="noopener">MySQL官网</a></p><p>yum仓库：<a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener">下载MySQL Yum存储库</a></p><blockquote><p>CentOS 7的默认yum仓库中并没有MySQL5.7，我们需要手动添加，好在MySQL官方提供了仓库的地址，所以我们能够比较简单地安装MySQL。</p><p>本文我们将介绍CentOS 7下MySQL5.7的安装。</p></blockquote><h2 id="添加MySQL5-7仓库"><a href="#添加MySQL5-7仓库" class="headerlink" title="添加MySQL5.7仓库"></a>添加MySQL5.7仓库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 地址来源于下载yum存储库时“No thanks, just start my download.”的地址</span></span><br><span class="line"></span><br><span class="line">rpm -ivh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><br></pre></td></tr></table></figure><h2 id="确认MySQL仓库成功添加"><a href="#确认MySQL仓库成功添加" class="headerlink" title="确认MySQL仓库成功添加"></a>确认MySQL仓库成功添加</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all | grep mysql | grep enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果展示像下面,则表示成功添加仓库:</span></span><br><span class="line">mysql-connectors-community/x86_64  MySQL Connectors Community    enabled:     51</span><br><span class="line">mysql-tools-community/x86_64       MySQL Tools Community         enabled:     63</span><br><span class="line">mysql57-community/x86_64           MySQL 5.7 Community Server    enabled:    267</span><br></pre></td></tr></table></figure><h2 id="开始安装MySQL5-7"><a href="#开始安装MySQL5-7" class="headerlink" title="开始安装MySQL5.7"></a>开始安装MySQL5.7</h2><p>这个过程用时较久（取决于你的网速）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-community-server</span><br></pre></td></tr></table></figure><h2 id="启动MySQL"><a href="#启动MySQL" class="headerlink" title="启动MySQL"></a>启动MySQL</h2><ol><li><p>启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure></li><li><p>设置系统启动时自动启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br></pre></td></tr></table></figure></li><li><p>查看启动状态</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure></li></ol><h2 id="MySQL的安全设置"><a href="#MySQL的安全设置" class="headerlink" title="MySQL的安全设置"></a>MySQL的安全设置</h2><p>CentOS上的root<code>默认密码</code>可以在文件<code>/var/log/mysqld.log</code>找到，通过下面命令可以打印出来</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该命令只能查询默认的初始密码（如果修改了密码，并不能查询到更改后的密码）</span></span><br><span class="line">cat /var/<span class="built_in">log</span>/mysqld.log | grep -i <span class="string">'temporary password'</span></span><br></pre></td></tr></table></figure><p>执行下面命令进行安全设置，这个命令会进行设置root密码设置，移除匿名用户，禁止root用户远程连接等</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><h3 id="MySQL5-7初始化密码报错"><a href="#MySQL5-7初始化密码报错" class="headerlink" title="MySQL5.7初始化密码报错"></a>MySQL5.7<code>初始化密码</code>报错</h3><p>报错信息：<code>ERROR 1820 (HY000): You must reset your password using ALTER USER statement before</code></p><ol><li><p><strong>mysql5.6是密码为空直接进入数据库的，但是mysql5.7就需要初始密码</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/<span class="built_in">log</span>/mysqld.log | grep -i <span class="string">'temporary password'</span></span><br></pre></td></tr></table></figure><p><img src="/img/mysql001.png" alt=""></p></li><li><p><strong>然后执行 <code>mysql -uroot -p</code> ，输入上面的到的密码进入，用该密码登录后，必须马上修改新的密码，不然会报如下错误：</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure><p><img src="/img/mysql002.png" alt=""></p></li><li><p><strong>如果你想要设置一个简单的测试密码的话，比如设置为<code>777888</code>，会提示这个错误，报错的意思就是你的密码不符合要求</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> identified by <span class="string">'777888'</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/mysql003.png" alt=""></p></li><li><p><strong>这个其实与validate_password_policy的值有关</strong></p><p><code>validate_password_policy</code>有以下取值：</p><p><img src="/img/mysql004.png" alt=""></p><p>默认是1，即MEDIUM，所以刚开始设置的密码<code>必须符合长度</code>，且<code>必须含有数字，小写或大写字母，特殊字符</code>。<br>有时候，只是为了自己测试，不想密码设置得那么复杂，譬如说，我只想设置root的密码为<code>777888</code>。<br>必须修改两个全局参数：</p><p>首先，修改<code>validate_password_policy</code>参数的值</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p><code>validate_password_length</code>(密码长度)参数默认为8，我们修改为1</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_length=1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p><strong>完成之后再次执行修改密码语句即可成功</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> identified by <span class="string">'777888'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></li></ol><h3 id="CentOS-如何修改MySQL用户root的密码"><a href="#CentOS-如何修改MySQL用户root的密码" class="headerlink" title="CentOS 如何修改MySQL用户root的密码"></a>CentOS 如何修改MySQL用户root的密码</h3><ol><li><p><strong>用帐号登录mysql</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">Enter password:<span class="comment"># 输入原密码</span></span><br></pre></td></tr></table></figure></li><li><p><strong>改变用户数据库</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure></li><li><p><strong>修改密码，记得密码要用<code>password()</code>函数进行加密，一定不要忘记！！！</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5.6版本修改密码</span></span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> password=password(<span class="string">'Your new password'</span>) <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.7版本下的mysql数据库下已经没有password这个字段了，password字段改成了authentication_string</span></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> authentication_string=password(<span class="string">'Your new password'</span>) <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure></li><li><p><strong>刷新权限表</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p><strong>退出MySQL</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></li><li><p><strong>重启MySQL</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></li></ol><h2 id="设置数据库编码为utf8"><a href="#设置数据库编码为utf8" class="headerlink" title="设置数据库编码为utf8"></a>设置数据库编码为utf8</h2><ol><li><p>打开配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure></li><li><p>在[mysqld]，[client]，[mysql]节点下添加编码设置（<code>原本就有的替换、没有的追加</code>成下面的内容）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES<span class="comment">#解释见附录 ***</span></span><br><span class="line">collation-server = utf8_unicode_ci</span><br><span class="line">init-connect=<span class="string">'SET NAMES utf8'</span></span><br><span class="line">character-set-server = utf8</span><br></pre></td></tr></table></figure></li><li><p>重启MySQL即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></li></ol><h1 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h1><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="sql-mode-常用值说明"><a href="#sql-mode-常用值说明" class="headerlink" title="sql_mode 常用值说明"></a>sql_mode 常用值说明</h2><p>引用：<a href="https://segmentfault.com/a/1190000005936172" target="_blank" rel="noopener">MySQL sql_mode 说明</a></p><p>官方手册专门有一节介绍 <a href="https://dev.mysql.com/doc/refman/5.6/en/sql-mode.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/sql-mode.html</a> 。 SQL Mode 定义了两个方面：MySQL应支持的SQL语法，以及应该在数据上执行何种确认检查。</p><h3 id="SQL语法支持类"><a href="#SQL语法支持类" class="headerlink" title="SQL语法支持类"></a>SQL语法支持类</h3><ul><li><p><strong>ONLY_FULL_GROUP_BY</strong> 对于GROUP BY聚合操作，如果在SELECT中的列、HAVING或者ORDER BY子句的列，没有在GROUP BY中出现，那么这个SQL是不合法的。是可以理解的，因为不在 group by 的列查出来展示会有矛盾。<br>在5.7中默认启用，所以在实施5.6升级到5.7的过程需要注意：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> Expression #1 of SELECT list is not in GROUP BY</span><br><span class="line">clause and contains nonaggregated column</span><br><span class="line">&apos;1066export.ebay_order_items.TransactionID&apos; which</span><br><span class="line">is not functionally dependent on columns in GROUP BY</span><br><span class="line">clause; this is incompatible with sql_mode=only_full_group_by</span><br></pre></td></tr></table></figure></li><li><p><strong>ANSI_QUOTES</strong> 启用 ANSI_QUOTES 后，不能用双引号来引用字符串，因为它被解释为识别符，作用与 <code>一样。设置它以后，</code>update t set f1=”” …`，会报 Unknown column ‘’ in ‘field list 这样的语法错误。</p></li><li><p><strong>PIPES_AS_CONCAT</strong> 将 <code>||</code> 视为字符串的连接操作符而非 或 运算符，这和Oracle数据库是一样的，也和字符串的拼接函数 CONCAT() 相类似。</p></li><li><p><strong>NO_TABLE_OPTIONS</strong> 使用 <code>SHOW CREATE TABLE</code> 时不会输出MySQL特有的语法部分，如 <code>ENGINE</code> ，这个在使用 mysqldump 跨DB种类迁移的时候需要考虑。</p></li><li><p><strong>NO_AUTO_CREATE_USER</strong> 字面意思不自动创建用户。在给MySQL用户授权时，我们习惯使用 <code>GRANT ... ON ... TO dbuser</code> 顺道一起创建用户。设置该选项后就与oracle操作类似，授权之前必须先建立用户。5.7.7开始也默认了。</p></li></ul><h3 id="数据检查类"><a href="#数据检查类" class="headerlink" title="数据检查类"></a>数据检查类</h3><ul><li><strong>NO_ZERO_DATE</strong> 认为日期 ‘0000-00-00’ 非法，与是否设置后面的严格模式有关。<ol><li>如果设置了严格模式，则 NO_ZERO_DATE 自然满足。但如果是 INSERT IGNORE 或 UPDATE IGNORE，’0000-00-00’依然允许且只显示warning</li><li>如果在非严格模式下，设置了<code>NO_ZERO_DATE</code>，效果与上面一样，’0000-00-00’允许但显示warning；如果没有设置<code>NO_ZERO_DATE</code>，no warning，当做完全合法的值。</li><li><code>NO_ZERO_IN_DATE</code>情况与上面类似，不同的是控制日期和天，是否可为 0 ，即 <code>2010-01-00</code> 是否合法。</li></ol></li><li><strong>NO_ENGINE_SUBSTITUTION</strong> 使用 <code>ALTER TABLE</code>或<code>CREATE TABLE</code> 指定 ENGINE 时， 需要的存储引擎被禁用或未编译，该如何处理。启用<code>NO_ENGINE_SUBSTITUTION</code>时，那么直接抛出错误；不设置此值时，CREATE用默认的存储引擎替代，ATLER不进行更改，并抛出一个 warning .</li><li><strong>STRICT_TRANS_TABLES</strong> 设置它，表示启用严格模式。<br>注意 <code>STRICT_TRANS_TABLES</code> 不是几种策略的组合，单独指 <code>INSERT</code>、<code>UPDATE</code>出现少值或无效值该如何处理：<ol><li>前面提到的把 ‘’ 传给int，严格模式下非法，若启用非严格模式则变成0，产生一个warning</li><li>Out Of Range，变成插入最大边界值</li><li>A value is missing when a new row to be inserted does not contain a value for a non-NULL column that has no explicit DEFAULT clause in its definition</li></ol></li></ul><p>上面并没有囊括所有的 SQL Mode，选了几个代表性的，详细还是 <a href="https://mariadb.com/kb/en/mariadb/sql_mode/" target="_blank" rel="noopener">看手册</a>。</p><p>sql_mode一般来说很少去关注它，没有遇到实际问题之前不会去启停上面的条目。我们常设置的 sql_mode 是 <code>ANSI</code>、<code>STRICT_TRANS_TABLES</code>、<code>TRADITIONAL</code>，ansi和traditional是上面的几种组合。</p><ul><li><code>ANSI</code>：更改语法和行为，使其更符合标准SQL<br>相当于REAL_AS_FLOAT, PIPES_AS_CONCAT, ANSI_QUOTES, IGNORE_SPACE</li><li><code>TRADITIONAL</code>：更像传统SQL数据库系统，该模式的简单描述是当在列中插入不正确的值时“给出错误而不是警告”。<br>相当于 STRICT_TRANS_TABLES, STRICT_ALL_TABLES, NO_ZERO_IN_DATE, NO_ZERO_DATE, ERROR_FOR_DIVISION_BY_ZERO, NO_AUTO_CREATE_USER, NO_ENGINE_SUBSTITUTION</li><li><code>ORACLE</code>：相当于 PIPES_AS_CONCAT, ANSI_QUOTES, IGNORE_SPACE, NO_KEY_OPTIONS, NO_TABLE_OPTIONS, NO_FIELD_OPTIONS, NO_AUTO_CREATE_USER</li></ul><p>无论何种mode，产生error之后就意味着单条sql执行失败，对于支持事务的表，则导致当前事务回滚；但如果没有放在事务中执行，或者不支持事务的存储引擎表，则可能导致数据不一致。MySQL认为，相比直接报错终止，数据不一致问题更严重。于是 <code>STRICT_TRANS_TABLES</code> 对非事务表依然尽可能的让写入继续，比如给个”最合理”的默认值或截断。而对于 <code>STRICT_ALL_TABLES</code>，如果是单条更新，则不影响，但如果更新的是多条，第一条成功，后面失败则会出现部分更新。</p><p>5.6.6 以后版本默认就是<code>NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</code>，5.5默认为 ‘’ 。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;在线安装&quot;&gt;&lt;a href=&quot;#在线安装&quot; class=&quot;headerlink&quot; title=&quot;在线安装&quot;&gt;&lt;/a&gt;在线安装&lt;/h1&gt;&lt;p&gt;引用：&lt;a href=&quot;https://juejin.im/post/5c088b066fb9a049d4419985&quot; t
      
    
    </summary>
    
      <category term="MySQL" scheme="/categories/MySQL/"/>
    
    
      <category term="数据库" scheme="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="MySQL" scheme="/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Servlet登录拦截器</title>
    <link href="/2019/07/11/Servlet%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <id>/2019/07/11/Servlet登录拦截器/</id>
    <published>2019-07-11T08:24:23.000Z</published>
    <updated>2019-07-11T08:30:38.716Z</updated>
    
    <content type="html"><![CDATA[<p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sunsheen.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sunsheen.jfids.system.config.Configs;</span><br><span class="line"><span class="keyword">import</span> com.sunsheen.jfids.system.security.login.Session;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet 登录过滤器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 92481</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LoginFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span></span><br><span class="line"><span class="function"><span class="params">                         FilterChain chain)</span><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">        <span class="comment">//获取url地址</span></span><br><span class="line">        String reqUrl = req.getRequestURI();</span><br><span class="line"><span class="comment">//        System.out.println("reqURL----------" + reqUrl);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 登录操作不做页面跳转</span></span><br><span class="line">    <span class="keyword">if</span>(reqUrl.contains(<span class="string">"/hkcloud/login.w.xhtml"</span>) </span><br><span class="line">    || reqUrl.contains(<span class="string">"/hkcloud/getUser"</span>)</span><br><span class="line">    || reqUrl.contains(<span class="string">"/hkcloud/login"</span>) </span><br><span class="line">    || reqUrl.contains(<span class="string">"/static/"</span>)</span><br><span class="line">    || reqUrl.endsWith(<span class="string">".css"</span>)</span><br><span class="line">    || reqUrl.endsWith(<span class="string">".js"</span>))&#123;</span><br><span class="line">    </span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">        HttpSession session = Session.getHttpSession();</span><br><span class="line">        String apiKey = (String) session.getAttribute(<span class="string">"ApiKey"</span>);</span><br><span class="line">        </span><br><span class="line">        HttpServletResponse res = (HttpServletResponse) response;</span><br><span class="line">        <span class="comment">// 如果session中存在apiKey证明用户登录，可以放行。否则认为未登陆重定向到登录界面</span></span><br><span class="line">        <span class="keyword">if</span> (apiKey == <span class="keyword">null</span> || apiKey.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        <span class="comment">// 登录页面地址</span></span><br><span class="line">        String loginUrl = Configs.get(<span class="string">"AllConfig.loginUrl"</span>);</span><br><span class="line">        <span class="comment">//如果request.getHeader("X-Requested-With") 返回的是"XMLHttpRequest"</span></span><br><span class="line">            <span class="comment">//说明就是ajax请求，需要特殊处理</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"XMLHttpRequest"</span>.equals(req.getHeader(<span class="string">"X-Requested-With"</span>)))&#123;</span><br><span class="line">                <span class="comment">//告诉ajax我是重定向</span></span><br><span class="line">            res.setHeader(<span class="string">"redirect"</span>, <span class="string">"redirect"</span>);</span><br><span class="line">                <span class="comment">//告诉ajax我重定向的路径</span></span><br><span class="line">                res.setHeader(<span class="string">"url"</span>, req.getContextPath() + loginUrl);</span><br><span class="line">                res.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.sendRedirect(req.getContextPath() + loginUrl);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig fConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注：</strong></p><p><code>ajax请求返回重定向信息</code></p><p>在项目中，考虑到web前台ajax请求未登录资源时，后台返回的重定向信息，ajax不能自动判断是否是重定向，以下是一种折中方法：</p><p>前端jquery.ajax默认设置，<code>ajax设置要放在程序ajax调用前</code>，我一般<code>放在公共js中统一引用到文件头里的</code>，这样调用ajax的时候就无需操心其他设置了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ajax默认设置 包括默认提交方式为POST， 判断后台是否是重定向</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$.ajaxSetup(&#123;</span><br><span class="line"><span class="comment">// 设置ajax请求结束后的执行动作</span></span><br><span class="line">complete : <span class="function"><span class="keyword">function</span>(<span class="params">XMLHttpRequest, textStatus</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 通过XMLHttpRequest取得响应头，redirect</span></span><br><span class="line"><span class="keyword">var</span> redirect = XMLHttpRequest.getResponseHeader(<span class="string">"redirect"</span>);</span><br><span class="line"><span class="keyword">if</span> (redirect == <span class="string">"redirect"</span>) &#123; <span class="comment">// 若HEADER中含有redirect说明后端想重定向</span></span><br><span class="line"><span class="keyword">var</span> win = <span class="built_in">window</span>;</span><br><span class="line"><span class="keyword">while</span> (win != win.top) &#123;</span><br><span class="line">win = win.top;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将后端重定向的地址取出来,使用win.location.href去实现重定向的要求</span></span><br><span class="line">win.location.href = XMLHttpRequest.getResponseHeader(<span class="string">"url"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">type : <span class="string">'POST'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br
      
    
    </summary>
    
      <category term="Java" scheme="/categories/Java/"/>
    
    
      <category term="拦截器" scheme="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    
      <category term="filter" scheme="/tags/filter/"/>
    
  </entry>
  
</feed>
